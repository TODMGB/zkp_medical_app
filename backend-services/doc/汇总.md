### **æœ€ç»ˆé¡¹ç›®æŠ¥å‘Šï¼šåŸºäºERC4337ä¸é›¶çŸ¥è¯†è¯æ˜çš„éšç§ä¿æŠ¤ç”¨è¯ä¾ä»æ€§å¹³å°**

**ç‰ˆæœ¬ï¼šV2.1 - ç”¨è¯ç®¡ç†ç³»ç»Ÿå·²å®Œæˆ**
**æ—¥æœŸï¼š2025å¹´10æœˆ31æ—¥**

---

#### **ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ„¿æ™¯**

##### **1.1 é¡¹ç›®æ‘˜è¦ (Executive Summary)**

æœ¬é¡¹ç›®æ—¨åœ¨è§£å†³å…¨çƒè€é¾„åŒ–èƒŒæ™¯ä¸‹ï¼Œè€å¹´äººç”¨è¯ä¾ä»æ€§è¿½è¸ªçš„æ ¸å¿ƒéš¾é¢˜â€”â€”**ä¿¡ä»»ç¼ºå¤±ä¸éšç§æ³„éœ²**ã€‚æˆ‘ä»¬è®¾è®¡å¹¶æ­£åœ¨å®ç°ä¸€ä¸ªåˆ›æ–°çš„æ™ºèƒ½å¥åº·å¹³å°ï¼Œé€šè¿‡æ·±åº¦æ•´åˆ**ERC4337è´¦æˆ·æŠ½è±¡ã€ç¤¾äº¤æ¢å¤ã€å»ä¸­å¿ƒåŒ–èº«ä»½ (DID)ã€é›¶çŸ¥è¯†è¯æ˜ (ZKP) å’Œç»†ç²’åº¦æƒé™ç®¡ç†**ï¼Œæ„å»ºäº†ä¸€ä¸ªåœ¨ä¿éšœç”¨æˆ·ç»å¯¹éšç§å’Œæ•°æ®ä¸»æƒå‰æä¸‹çš„ã€æ•°å­¦ä¸Šå¯ä¿¡çš„å¥åº·è®°å½•ç³»ç»Ÿã€‚

##### **1.2 å®æ–½çŠ¶æ€è¯´æ˜**

**âœ… å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ (Phase 1 & 2)**:

**Phase 1 - åŸºç¡€è®¾æ–½** (2025å¹´10æœˆä¸­æ—¬å®Œæˆ):
- **ERC4337è´¦æˆ·æŠ½è±¡**: åŸºäºæ™ºèƒ½åˆçº¦çš„è´¦æˆ·ç³»ç»Ÿï¼Œæ”¯æŒGasä»£ä»˜
- **ç¤¾äº¤æ¢å¤æœºåˆ¶**: é€šè¿‡å®ˆæŠ¤è€…å®ç°è´¦æˆ·æ¢å¤ï¼Œæ— éœ€åŠ©è®°è¯
- **ç”¨æˆ·èº«ä»½è®¤è¯**: åŸºäºEOAç­¾åçš„å»ä¸­å¿ƒåŒ–èº«ä»½éªŒè¯
- **è®¿é—®ç»„æƒé™ç®¡ç†**: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ç³»ç»Ÿ
- **å…³ç³»ç®¡ç†ç³»ç»Ÿ**: é‚€è¯·æœºåˆ¶ã€å…³ç³»æš‚åœ/æ¢å¤/æ’¤é”€
- **è´¦æˆ·è¿ç§»æœåŠ¡**: æ”¯æŒè®¾å¤‡é—´çš„å®‰å…¨è´¦æˆ·è¿ç§»
- **ä¸ªäººæ¡£æ¡ˆæœåŠ¡**: èº«ä»½ä¿¡æ¯éªŒè¯ä¸ç®¡ç†
- **æ¶ˆæ¯é€šçŸ¥æœåŠ¡**: å¤šæ¸ é“é€šçŸ¥æ¨é€ï¼ˆWebSocket/FCM/APNsï¼‰
- **å®‰å…¨æ•°æ®ä¼ è¾“æœåŠ¡**: ç«¯åˆ°ç«¯åŠ å¯†æ•°æ®ä¼ è¾“
- **ZKPè¯æ˜ç”ŸæˆæœåŠ¡**: å¼‚æ­¥é›¶çŸ¥è¯†è¯æ˜ç”Ÿæˆï¼ˆåç«¯é‡é‡çº§è®¡ç®—ï¼‰

**Phase 2 - åº”ç”¨å±‚** (2025å¹´10æœˆ30æ—¥å®Œæˆ):
- **ç”¨è¯ç®¡ç†ç³»ç»Ÿ**: âœ… å·²å®Œæˆ
  - å¸¸ç”¨è¯ç‰©åº“ï¼ˆ150ç§è¯ç‰©ï¼Œ9å¤§åˆ†ç±»ï¼‰
  - ç”¨è¯è®¡åˆ’ç®¡ç†ï¼ˆCRUDï¼‰
  - è®¡åˆ’åŠ å¯†åˆ†äº«ï¼ˆåŸºäºè®¿é—®ç»„ï¼‰
  - ä¸Secure Exchange Serviceé›†æˆï¼ˆç«¯åˆ°ç«¯åŠ å¯†ï¼‰
  - å®Œæ•´çš„E2Eæµ‹è¯•ï¼ˆ1028è¡Œæµ‹è¯•ä»£ç ï¼‰

**ğŸš§ Phase 2è¿›è¡Œä¸­åŠŸèƒ½**:
- **é›¶çŸ¥è¯†è¯æ˜æ‰“å¡**: è§„åˆ’ä¸­ï¼ˆå‰ç«¯è½»é‡çº§ï¼‰
- **ç”¨è¯æé†’æ¨é€**: å¼€å‘ä¸­
- **ç”¨è¯è®°å½•ç»Ÿè®¡**: è§„åˆ’ä¸­
- **å‘¨åº¦æ±‡æ€»ä¸Šé“¾**: è§„åˆ’ä¸­ï¼ˆå°†ZKPè¯æ˜æäº¤åŒºå—é“¾ï¼‰
- **AIéšç§åˆ†æ**: è§„åˆ’ä¸­ï¼ˆåŸºäºè„±æ•æ•°æ®çš„æ™ºèƒ½å¥åº·åˆ†æï¼‰

##### **1.3 é¡¹ç›®æ„¿æ™¯ä¸ç›®æ ‡**

*   **æ„¿æ™¯**: åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¯ä»¥ç»å¯¹æŒæ§è‡ªå·±å¥åº·æ•°æ®ï¼Œå¹¶èƒ½å‘å…¶ä¿¡ä»»çš„äººï¼ˆå®¶äººã€åŒ»ç”Ÿï¼‰æ— ç¼ã€å¯ä¿¡åœ°è¯æ˜å…¶å¥åº·è¡Œä¸ºçš„å»ä¸­å¿ƒåŒ–ç½‘ç»œã€‚
*   **æ ¸å¿ƒç›®æ ‡**:
    1.  **ä¿¡ä»»**: æä¾›ä¸€ä»½ä¸å¯ç¯¡æ”¹ã€æ•°å­¦ä¸Šå¯éªŒè¯çš„ç”¨è¯è®°å½•ã€‚
    2.  **éšç§**: ç¡®ä¿é™¤ç”¨æˆ·æ˜ç¡®æˆæƒæ–¹å¤–ï¼Œä»»ä½•äººéƒ½æ— æ³•è®¿é—®ç”¨æˆ·çš„å¥åº·è¯¦æƒ…ã€‚
    3.  **æ˜“ç”¨**: ä¸ºè€å¹´ç”¨æˆ·æä¾›"é›¶æ‘©æ“¦"çš„ä½“éªŒï¼Œå®Œå…¨å±è”½æ‰€æœ‰Web3æŠ€æœ¯çš„å¤æ‚æ€§ã€‚
    4.  **å®‰å…¨**: é€šè¿‡ç¤¾äº¤æ¢å¤æœºåˆ¶ï¼Œæ— éœ€åŠ©è®°è¯å³å¯æ¢å¤è´¦æˆ·ã€‚

---

#### **ç¬¬äºŒéƒ¨åˆ†ï¼šè½¯ä»¶æ¶æ„è®¾è®¡**

##### **2.1 æ ¸å¿ƒæ¶æ„åŸåˆ™**

*   **ç”¨æˆ·ä¸»æƒ**: ç§é’¥æ°¸ä¸ç¦»å¼€ç”¨æˆ·è®¾å¤‡ï¼Œç”¨æˆ·å®Œå…¨æŒæ§è‡ªå·±çš„æ•°å­—èº«ä»½ã€‚
*   **ä¿¡ä»»æœ€å°åŒ–**: åç«¯æœåŠ¡å™¨ä¸å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œä»…ä½œä¸ºåè°ƒè€…å’Œä¸­ç»§è€…ã€‚
*   **é›¶Gasè´¹ç”¨**: æ‰€æœ‰é“¾ä¸Šæ“ä½œç”±Paymasterä»£ä»˜ï¼Œç”¨æˆ·æ— éœ€æŒæœ‰ETHã€‚
*   **ç¤¾äº¤æ¢å¤**: é€šè¿‡å®ˆæŠ¤è€…æœºåˆ¶ï¼Œå³ä½¿ä¸¢å¤±ç§é’¥ä¹Ÿèƒ½æ¢å¤è´¦æˆ·ã€‚

##### **2.2 ç³»ç»Ÿç»„ä»¶è¯¦è§£**

*   **å®¢æˆ·ç«¯ (Vue + Capacitor)**: è´Ÿè´£UIã€èº«ä»½ç®¡ç†ï¼ˆEOAé’±åŒ…ï¼‰ã€æƒé™ç®¡ç†ã€æœ¬åœ°æ•°æ®åŠ å¯†ã€ZKPè¯æ˜ç”Ÿæˆã€‚
*   **API Gateway (Node.js)**: ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è®¤è¯ã€è·¯ç”±è½¬å‘ã€è¯·æ±‚æ—¥å¿—ã€‚
*   **å¾®æœåŠ¡é›†ç¾¤**:
    - **User Service**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è§’è‰²ç®¡ç† (HTTP 3001, gRPC 50051)
    - **Relationship Service**: è®¿é—®ç»„ã€é‚€è¯·ã€å…³ç³»ç®¡ç† (HTTP 3004, gRPC 50052)
    - **ERC4337 Service**: è´¦æˆ·æŠ½è±¡ã€ç¤¾äº¤æ¢å¤ã€å®ˆæŠ¤è€…ç®¡ç† (HTTP 3002, gRPC 50053)
    - **Userinfo Service**: ä¸ªäººæ¡£æ¡ˆæŸ¥è¯¢ã€èº«ä»½éªŒè¯ (HTTP 5000)
    - **Secure Exchange Service**: åŠ å¯†æ•°æ®ä¼ è¾“ã€ç«¯åˆ°ç«¯åŠ å¯† (HTTP 3006, gRPC 50056)
    - **Medication Service**: ç”¨è¯è®¡åˆ’ã€è¯ç‰©ä¿¡æ¯åº“ã€è®¡åˆ’åˆ†äº« (HTTP 3007, gRPC 50057) âœ… æ–°å¢
    - **Migration Service**: è®¾å¤‡è¿ç§»ã€ä¼šè¯ç®¡ç† (HTTP 3008)
    - **Notification Service**: å®æ—¶é€šçŸ¥ã€WebSocketæ¨é€ã€æ¶ˆæ¯é˜Ÿåˆ— (HTTP 3005, WebSocket)
    - **ZKP Service**: é›¶çŸ¥è¯†è¯æ˜ç”Ÿæˆã€ä»»åŠ¡ç®¡ç† (HTTP 3003)
*   **åŒºå—é“¾å±‚ (Solidity)**: 
    - **EntryPoint**: ERC4337æ ‡å‡†å…¥å£ç‚¹
    - **SocialRecoveryAccount**: ç¤¾äº¤æ¢å¤è´¦æˆ·åˆçº¦
    - **SimplePaymaster**: Gasä»£ä»˜åˆçº¦
    - **ZKPéªŒè¯åˆçº¦** (è§„åˆ’ä¸­): ç”¨äºéªŒè¯ç”¨è¯æ‰“å¡è¯æ˜

##### **2.3 æ¶æ„å›¾**

```mermaid
graph TD
    subgraph ç”¨æˆ·å±‚
        U1[è€äºº]
        U2[å®¶å±]
        U3[åŒ»æŠ¤äººå‘˜]
    end

    subgraph å®¢æˆ·ç«¯å±‚ Vue + Capacitor
        C_UI[UI/UX ç•Œé¢]
        C_WALLET[EOAé’±åŒ…ç®¡ç†]
        C_AUTH[æƒé™/è®¿é—®ç»„ç®¡ç†]
        C_ZKP[ZKPè¯æ˜ç”Ÿæˆ è§„åˆ’ä¸­]
    end
    
    subgraph APIç½‘å…³å±‚
        GW[API Gateway :3000<br/>è®¤è¯ è·¯ç”± æ—¥å¿—]
    end
    
    subgraph å¾®æœåŠ¡å±‚
        US[User Service :3001<br/>HTTP + gRPC:50051]
        RS[Relationship Service :3004<br/>HTTP + gRPC:50052]
        ERC[ERC4337 Service :3002<br/>HTTP + gRPC:50053]
        UI[Userinfo Service :5000<br/>HTTP]
        SE[Secure Exchange :3006<br/>HTTP + gRPC:50056]
        MED[Medication Service :3007<br/>HTTP + gRPC:50057 âœ…æ–°å¢]
        MS[Migration Service :3008<br/>HTTP]
        NS[Notification Service :3005<br/>HTTP/WebSocket/MQ]
        ZKP[ZKP Service :3003<br/>HTTP]
    end

    subgraph åŒºå—é“¾å±‚ Ethereum
        EP[EntryPoint<br/>ERC4337å…¥å£]
        SRA[SocialRecoveryAccount<br/>ç¤¾äº¤æ¢å¤è´¦æˆ·]
        PM[SimplePaymaster<br/>Gasä»£ä»˜]
        ZKP_V[ZKPéªŒè¯åˆçº¦<br/>è§„åˆ’ä¸­]
    end
    
    subgraph æ•°æ®å±‚
        PG[(PostgreSQL<br/>ç”¨æˆ·/å…³ç³»/è¿ç§»)]
        REDIS[(Redis<br/>ç¼“å­˜/ä¼šè¯)]
        MQ[RabbitMQ<br/>æ¶ˆæ¯é˜Ÿåˆ—]
    end
    
    %% -- äº¤äº’æµç¨‹ --
    U1 & U2 & U3 --> C_UI
    C_UI --> C_WALLET & C_AUTH & C_ZKP
    
    C_WALLET & C_AUTH --> GW
    GW --> US & RS & ERC & UI & SE & MED & MS & NS & ZKP
    
    US & RS & SE & MED & MS & NS --> PG
    US & RS & SE & MED & NS & ZKP --> REDIS
    US & RS & SE & MED & NS & ZKP --> MQ
    
    ERC --> EP
    EP --> SRA
    EP --> PM
    
    C_ZKP -.è§„åˆ’ä¸­.-> ZKP_V
```

##### **2.4 æ•°æ®åº“æ¶æ„**

```mermaid
erDiagram
    users {
        uuid u_id PK "ç”¨æˆ·UUID"
        varchar eoa_address UK "EOAåœ°å€(ç­¾å)"
        varchar smart_account UK "Smart Account(ä¸»é”®)"
        varchar username "ç”¨æˆ·å"
        boolean is_active "æ˜¯å¦æ¿€æ´»"
    }
    
    user_roles {
        uuid u_id FK "ç”¨æˆ·ID"
        varchar role "è§’è‰²: elderly/doctor/guardian"
    }

    access_groups {
        int id PK
        varchar owner_address FK "åˆ›å»ºè€…Smart Account"
        varchar group_name "è®¿é—®ç»„å"
        varchar group_type "ç»„ç±»å‹"
        varchar description "æè¿°"
    }
    
    invitations {
        int id PK
        varchar token UK "é‚€è¯·ä»¤ç‰Œ"
        varchar inviter_address FK "é‚€è¯·äºº"
        varchar invitee_address "è¢«é‚€è¯·äºº(å¯é€‰)"
        int access_group_id FK "ç›®æ ‡è®¿é—®ç»„"
        varchar invitation_type "æ ‡å‡†/åŒ»é™¢é¢„æˆæƒ"
        varchar status "pending/accepted/expired"
        timestamp expires_at "è¿‡æœŸæ—¶é—´"
    }
    
    user_relationships {
        int id PK
        varchar principal_address FK "æ•°æ®æ‰€æœ‰è€…(è€äºº)"
        varchar viewer_address FK "æŸ¥çœ‹è€…(å®¶å±/åŒ»ç”Ÿ)"
        int access_group_id FK "æ‰€å±è®¿é—®ç»„"
        varchar status "active/suspended"
        int permission_level "æƒé™çº§åˆ«"
    }
    
    migration_sessions {
        varchar id PK "è¿ç§»ä¼šè¯ID"
        varchar status "pending/completed/expired"
        varchar old_device_id "æ—§è®¾å¤‡ID"
        varchar new_device_id "æ–°è®¾å¤‡ID"
        varchar confirm_code "6ä½ç¡®è®¤ç "
        bigint expires_at "è¿‡æœŸæ—¶é—´æˆ³"
    }
    
    persons_å®ä½“æ¡£æ¡ˆ {
        int id PK
        varchar id_card_number UK "èº«ä»½è¯å·"
        varchar phone_number UK "æ‰‹æœºå·"
        varchar full_name "å§“å"
        varchar role "è§’è‰²"
    }
    
    notifications {
        int notification_id PK "é€šçŸ¥ID"
        varchar recipient_address FK "æ¥æ”¶è€…åœ°å€"
        varchar notification_type "é€šçŸ¥ç±»å‹"
        varchar title "æ ‡é¢˜"
        text message "æ¶ˆæ¯å†…å®¹"
        jsonb data "é™„åŠ æ•°æ®"
        timestamp read_at "é˜…è¯»æ—¶é—´"
        timestamp created_at "åˆ›å»ºæ—¶é—´"
    }
    
    zkp_tasks_è§„åˆ’ä¸­ {
        varchar job_id PK "ä»»åŠ¡ID"
        varchar user_address FK "ç”¨æˆ·åœ°å€"
        varchar circuit_name "ç”µè·¯åç§°"
        varchar status "processing/completed/failed"
        jsonb proof_data "è¯æ˜æ•°æ®"
        timestamp created_at "åˆ›å»ºæ—¶é—´"
    }
    
    medication_plans {
        uuid plan_id PK "è®¡åˆ’ID"
        varchar patient_address FK "æ‚£è€…åœ°å€"
        varchar doctor_address FK "åŒ»ç”Ÿåœ°å€"
        varchar plan_name "è®¡åˆ’åç§°"
        varchar diagnosis "è¯Šæ–­ä¿¡æ¯"
        date start_date "å¼€å§‹æ—¥æœŸ"
        date end_date "ç»“æŸæ—¥æœŸ"
        varchar status "active/paused/completed/cancelled"
        text notes "å¤‡æ³¨"
        timestamp created_at "åˆ›å»ºæ—¶é—´"
    }
    
    medication_items {
        uuid item_id PK "è¯ç‰©æ¡ç›®ID"
        uuid plan_id FK "æ‰€å±è®¡åˆ’"
        varchar medication_name "è¯ç‰©åç§°"
        varchar dosage "å‰‚é‡"
        varchar frequency "é¢‘ç‡"
        varchar timing "æœè¯æ—¶é—´"
        varchar duration "ç–—ç¨‹"
        text special_instructions "ç‰¹æ®Šè¯´æ˜"
    }
    
    plan_shares {
        uuid share_id PK "åˆ†äº«ID"
        uuid plan_id FK "è®¡åˆ’ID"
        varchar sender_address FK "åˆ†äº«è€…"
        varchar recipient_address FK "æ¥æ”¶è€…"
        varchar access_group_id FK "è®¿é—®ç»„ID"
        varchar encrypted_key "åŠ å¯†çš„è§£å¯†å¯†é’¥"
        timestamp shared_at "åˆ†äº«æ—¶é—´"
    }
    
    common_medications {
        int medication_id PK "è¯ç‰©ID"
        varchar medication_name "è¯ç‰©åç§°"
        varchar category "è¯ç‰©åˆ†ç±»"
        varchar common_dosage "å¸¸ç”¨å‰‚é‡"
        text indications "é€‚åº”ç—‡"
        text side_effects "å‰¯ä½œç”¨"
    }
    
    %% è§„åˆ’ä¸­çš„è¡¨ç»“æ„
    checkin_credentials_è§„åˆ’ä¸­ {
        int id PK
        varchar owner_address FK "æ‰“å¡è€…"
        varchar medication_hash "è¯å“å“ˆå¸Œ(åŒ¿åID)"
        varchar checkin_commitment "æ‰“å¡æ‰¿è¯º(ZKP)"
        text encrypted_payload "åŠ å¯†å‡­è¯"
    }
    
    users ||--o{ user_roles : "æ‹¥æœ‰"
    users ||--o{ access_groups : "åˆ›å»º"
    users ||--o{ invitations : "å‘å‡º"
    users ||--o{ user_relationships : "ä½œä¸ºæ•°æ®æ‰€æœ‰è€…"
    users ||--o{ user_relationships : "ä½œä¸ºæŸ¥çœ‹è€…"
    users ||--o{ notifications : "æ¥æ”¶"
    users ||--o{ medication_plans : "ä½œä¸ºæ‚£è€…"
    users ||--o{ medication_plans : "ä½œä¸ºåŒ»ç”Ÿ"
    access_groups ||--o{ invitations : "å…³è”"
    access_groups ||--o{ user_relationships : "è¢«åˆ†é…"
    access_groups ||--o{ plan_shares : "åˆ†äº«ç»™è®¿é—®ç»„"
    persons_å®ä½“æ¡£æ¡ˆ ||--o| users : "èº«ä»½éªŒè¯"
    medication_plans ||--o{ medication_items : "åŒ…å«è¯ç‰©"
    medication_plans ||--o{ plan_shares : "è¢«åˆ†äº«"
```

---

#### **ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½ä¸ç”¨æˆ·ç•Œé¢**

##### **3.1 é¦–æ¬¡å¯åŠ¨ä¸è´¦æˆ·åˆ›å»º âœ…å·²å®ç°**

**æµç¨‹**: ç”¨æˆ·é¦–æ¬¡æ‰“å¼€Appï¼Œç³»ç»Ÿå¼•å¯¼åˆ›å»ºEOAé’±åŒ…å’ŒERC4337ç¤¾äº¤æ¢å¤è´¦æˆ·ã€‚

**çº¿æ¡†å›¾**:
```
+-------------------------------------------+
|                                           |
|         æ¬¢è¿ä½¿ç”¨ ZKPå¥åº·å®ˆæŠ¤               |
|                                           |
|    [æ’å›¾ï¼šä¸€ä¸ªç›¾ç‰Œå’Œçˆ±å¿ƒ]                  |
|                                           |
|   æˆ‘ä»¬å°†ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æ•°å­—èº«ä»½          |
|   æ— éœ€è®°ä½å¤æ‚çš„åŠ©è®°è¯                     |
|                                           |
|   [ è¯·è¾“å…¥ä¸€ä¸ªå¯†ç ä¿æŠ¤æ‚¨çš„é’±åŒ… ]           |
|   ( ******* )                             |
|                                           |
|   [ è¯·å†æ¬¡ç¡®è®¤å¯†ç  ] ( ******* )          |
|                                           |
|           +-----------------+             |
|           |   åˆ›å»ºæˆ‘çš„æ•°å­—èº«ä»½  |             |
|           +-----------------+             |
|                                           |
|  æç¤ºï¼šæ‚¨çš„ç§é’¥å°†å®‰å…¨å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ä¸­        |
|       ç³»ç»Ÿå°†è‡ªåŠ¨åˆ›å»ºæ™ºèƒ½è´¦æˆ·               |
|                                           |
+-------------------------------------------+
```

**æŠ€æœ¯ç»†èŠ‚**:
1. å®¢æˆ·ç«¯ç”ŸæˆEOAå¯†é’¥å¯¹ï¼ˆç§é’¥æœ¬åœ°åŠ å¯†å­˜å‚¨ï¼‰
2. è°ƒç”¨APIé¢„è®¡ç®—Smart Accountåœ°å€
3. å®Œæˆæ³¨å†Œï¼Œç³»ç»Ÿè‡ªåŠ¨ä¸ºè€äººåˆ›å»ºé»˜è®¤è®¿é—®ç»„

##### **3.2 ä¸»ç•Œé¢ä¸æ¯æ—¥æ‰“å¡ ğŸš§è§„åˆ’ä¸­**

**æµç¨‹**: ç”¨æˆ·è¿›å…¥ä¸»ç•Œé¢ï¼Œçœ‹åˆ°ä»Šæ—¥çš„ç”¨è¯ä»»åŠ¡ï¼Œç‚¹å‡»æ‰“å¡ã€‚

**çº¿æ¡†å›¾**:
```
+-------------------------------------------+
|  å¼ å¤§çˆ·, æ—©ä¸Šå¥½ï¼  [å¤´åƒ]                  |
|  ä»Šå¤©æ˜¯ 2025å¹´10æœˆ28æ—¥ æ˜ŸæœŸä¸€             |
|  Smart Account: 0x1234...5678            |
|-------------------------------------------|
|                                           |
|   **ä»Šæ—¥ç”¨è¯ä»»åŠ¡ (2)**                     |
|                                           |
|  +---------------------------------------+  |
|  | [ä¸Šåˆ8:00] æ°¨æ°¯åœ°å¹³ (é™å‹è¯)          |  |
|  |                                [ æ‰“å¡ ] |  |
|  +---------------------------------------+  |
|                                           |
|  +---------------------------------------+  |
|  | [æ™šä¸Š8:00] ç»´ç”Ÿç´ D3                   |  |
|  |                                (å¾…åŠ)   |  |
|  +---------------------------------------+  |
|                                           |
|   [æŸ¥çœ‹æœ¬å‘¨è®°å½•]   [ç®¡ç†æˆ‘çš„å®¶åº­åœˆ]         |
|                                           |
|-------------------------------------------|
| [é¦–é¡µ]  [è®°å½•]  [å®ˆæŠ¤è€…]  [æˆ‘çš„]           |
+-------------------------------------------+
```

##### **3.3 å®ˆæŠ¤è€…ç®¡ç† (ç¤¾äº¤æ¢å¤) âœ…å·²å®ç°**

**æµç¨‹**: ç”¨æˆ·è®¾ç½®å®ˆæŠ¤è€…ï¼ˆå®¶äºº/æœ‹å‹ï¼‰ï¼Œå½“ä¸¢å¤±ç§é’¥æ—¶å¯é€šè¿‡å®ˆæŠ¤è€…æ¢å¤è´¦æˆ·ã€‚

**çº¿æ¡†å›¾**:
```
+-------------------------------------------+
| < è¿”å›          æˆ‘çš„å®ˆæŠ¤è€…                 |
|-------------------------------------------|
|                                           |
| **å½“å‰å®ˆæŠ¤è€… (2/3)**                       |
| æ¢å¤é˜ˆå€¼: è‡³å°‘2äººåŒæ„å³å¯æ¢å¤è´¦æˆ·           |
|                                           |
| +---------------------------------------+ |
| | ğŸ‘¤ å¼ å°æ˜ (å„¿å­)                       | |
| |    Smart Account: 0xabc...def         | |
| |    çŠ¶æ€: âœ… å·²ç¡®è®¤                     | |
| +---------------------------------------+ |
|                                           |
| +---------------------------------------+ |
| | ğŸ‘¤ æç¾ä¸½ (å¥³å„¿)                       | |
| |    Smart Account: 0x123...789         | |
| |    çŠ¶æ€: âœ… å·²ç¡®è®¤                     | |
| +---------------------------------------+ |
|                                           |
| [â• æ·»åŠ å®ˆæŠ¤è€…]   [âš™ï¸ ä¿®æ”¹é˜ˆå€¼]            |
|                                           |
| ğŸ’¡ æç¤ºï¼šå®ˆæŠ¤è€…å¯ä»¥å¸®åŠ©æ‚¨åœ¨ä¸¢å¤±å¯†ç æ—¶       |
|   æ¢å¤è´¦æˆ·ï¼Œå»ºè®®è®¾ç½®2-3ä½å¯ä¿¡èµ–çš„å®¶äºº       |
|                                           |
+-------------------------------------------+
```

##### **3.4 æƒé™ç®¡ç† (è®¿é—®ç»„) âœ…å·²å®ç°**

**æµç¨‹**: è€äººåˆ›å»ºè®¿é—®ç»„ï¼Œé‚€è¯·ä¸åŒçš„äººåŠ å…¥ï¼Œå®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶ã€‚

**çº¿æ¡†å›¾**:
```
+-------------------------------------------+
| < è¿”å›          æˆ‘çš„å®¶åº­åœˆ                 |
|-------------------------------------------|
|                                           |
| **è®¿é—®ç»„ (3)**                            |
|                                           |
| +---------------------------------------+ |
| | ğŸ“‹ ä¸»æ²»åŒ»ç”Ÿ                            | |
| |    æˆå‘˜: 1äºº                           | |
| |    [ç®¡ç†] [é‚€è¯·]                       | |
| +---------------------------------------+ |
|                                           |
| +---------------------------------------+ |
| | ğŸ“‹ å®¶åº­æ ¸å¿ƒæˆå‘˜                        | |
| |    æˆå‘˜: 2äºº                           | |
| |    [ç®¡ç†] [é‚€è¯·]                       | |
| +---------------------------------------+ |
|                                           |
| +---------------------------------------+ |
| | ğŸ“‹ å­å¥³                                | |
| |    æˆå‘˜: 3äºº                           | |
| |    [ç®¡ç†] [é‚€è¯·]                       | |
| +---------------------------------------+ |
|                                           |
| [â• æ–°å»ºè®¿é—®ç»„]                           |
|                                           |
| ğŸ’¡ è®¿é—®ç»„å¯ä»¥æ§åˆ¶è°èƒ½çœ‹åˆ°æ‚¨çš„å¥åº·æ•°æ®       |
|                                           |
+-------------------------------------------+
```

##### **3.5 é‚€è¯·æµç¨‹ âœ…å·²å®ç°**

**çº¿æ¡†å›¾**:
```
+-------------------------------------------+
| < è¿”å›          é‚€è¯·æ–°æˆå‘˜                 |
|-------------------------------------------|
|                                           |
| **é€‰æ‹©è®¿é—®ç»„**                            |
| [v] ä¸»æ²»åŒ»ç”Ÿ                              |
|                                           |
| **é‚€è¯·æ–¹å¼**                              |
|                                           |
| ( ) æ ‡å‡†é‚€è¯· - ç”ŸæˆäºŒç»´ç /é“¾æ¥             |
| (â€¢) åŒ»é™¢é‚€è¯· - è¾“å…¥åŒ»ç”ŸSmart Account       |
|                                           |
| Smart Accountåœ°å€:                        |
| [ 0x... ]                                |
|                                           |
| åŒ»é™¢ä¿¡æ¯:                                 |
| åŒ»é™¢ID: [ hospital_001 ]                  |
| åŒ»é™¢åç§°: [ XXç¤¾åŒºå«ç”ŸæœåŠ¡ä¸­å¿ƒ ]           |
|                                           |
| [ç”Ÿæˆé‚€è¯·]                                |
|                                           |
| --- ç”Ÿæˆå ---                            |
| [äºŒç»´ç æ˜¾ç¤ºåŒºåŸŸ]                          |
|                                           |
| é‚€è¯·ä»¤ç‰Œ: inv_abc123def456                |
| æœ‰æ•ˆæœŸ: 24å°æ—¶                            |
|                                           |
| [åˆ†äº«] [å–æ¶ˆé‚€è¯·]                         |
|                                           |
+-------------------------------------------+
```

---

#### **ç¬¬å››éƒ¨åˆ†ï¼šæ ¸å¿ƒæŠ€æœ¯æµç¨‹è¯¦è§£**

#### **é˜¶æ®µä¸€ï¼šå·²å®ç°çš„æµç¨‹**

##### **å›¾ 1ï¼šèº«ä»½åˆ›å»ºä¸ERC4337è´¦æˆ·éƒ¨ç½² âœ…**

**æµç¨‹æè¿°**: æ–°ç”¨æˆ·é¦–æ¬¡æ‰“å¼€Appï¼Œç³»ç»Ÿåˆ›å»ºEOAé’±åŒ…å’ŒERC4337ç¤¾äº¤æ¢å¤è´¦æˆ·ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(è€äºº)
    participant A as Appå®¢æˆ·ç«¯
    participant GW as API Gateway
    participant ERC as ERC4337 Service
    participant US as User Service
    participant BC as åŒºå—é“¾

    U->>A: é¦–æ¬¡æ‰“å¼€App, è¾“å…¥å¯†ç 
    
    Note over A: 1. å®¢æˆ·ç«¯ç”ŸæˆEOAå¯†é’¥å¯¹
    A->>A: ç”ŸæˆEOAç§é’¥/å…¬é’¥(ä½¿ç”¨å¯†ç åŠ å¯†å­˜å‚¨)
    
    Note over A,ERC: 2. é¢„è®¡ç®—Smart Accountåœ°å€
    A->>GW: POST /api/erc4337/account/address
    GW->>ERC: è½¬å‘è¯·æ±‚ {ownerAddress: EOA}
    ERC->>ERC: è°ƒç”¨AccountFactory.getAddress()
    ERC-->>A: è¿”å› {accountAddress: 0x...}
    
    Note over A,US: 3. æ³¨å†Œç”¨æˆ·èº«ä»½
    A->>GW: POST /api/auth/register
    GW->>US: gRPC RegisterUser
    US->>US: éªŒè¯èº«ä»½ä¿¡æ¯, åˆ†é…è§’è‰²
    US-->>A: è¿”å› {token, user, roles}
    
    Note over A: 4. å¯é€‰ï¼šç«‹å³éƒ¨ç½²è´¦æˆ·æˆ–é¦–æ¬¡ä½¿ç”¨æ—¶éƒ¨ç½²
    alt ç«‹å³éƒ¨ç½²
        A->>GW: POST /api/erc4337/account
        GW->>ERC: {ownerAddress, guardians:[], threshold:0}
        ERC->>BC: éƒ¨ç½² SocialRecoveryAccount
        BC-->>A: {accountAddress, txHash}
    end
    
    A->>U: è´¦æˆ·åˆ›å»ºæˆåŠŸ! æ˜¾ç¤ºSmart Accountåœ°å€
```

---

##### **å›¾ 2ï¼šæ·»åŠ å®ˆæŠ¤è€… (ç¤¾äº¤æ¢å¤è®¾ç½®) âœ…**

**æµç¨‹æè¿°**: ç”¨æˆ·æ·»åŠ å®ˆæŠ¤è€…ï¼Œé‡‡ç”¨å®‰å…¨çš„ä¸¤æ­¥å¼æµç¨‹ï¼ˆç§é’¥æ°¸ä¸ä¸Šä¼ ï¼‰ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(Owner)
    participant A as Appå®¢æˆ·ç«¯
    participant GW as API Gateway
    participant ERC as ERC4337 Service
    participant BC as åŒºå—é“¾(EntryPoint)

    U->>A: è¾“å…¥å®ˆæŠ¤è€…çš„Smart Accountåœ°å€
    
    Note over A,ERC: æ­¥éª¤1: æ„å»ºæœªç­¾åUserOperation
    A->>GW: POST /api/erc4337/guardian/build
    GW->>ERC: {accountAddress, guardianAddress}
    ERC->>ERC: æ„å»ºaddGuardiançš„callData
    ERC->>ERC: ç”ŸæˆUserOp, è®¾ç½®Paymaster
    ERC->>ERC: è®¡ç®—UserOpHash
    ERC-->>A: {userOp(æœªç­¾å), userOpHash}
    
    Note over A: æ­¥éª¤2: å®¢æˆ·ç«¯æœ¬åœ°ç­¾å
    A->>A: ä½¿ç”¨Ownerçš„EOAç§é’¥ç­¾åuserOpHash
    A->>A: userOp.signature = signature
    
    Note over A,BC: æ­¥éª¤3: æäº¤å·²ç­¾åUserOp
    A->>GW: POST /api/erc4337/guardian/submit
    GW->>ERC: {userOp(å·²ç­¾å)}
    ERC->>BC: handleOps([userOp])
    activate BC
    BC->>BC: éªŒè¯ç­¾å
    BC->>BC: æ‰§è¡ŒaddGuardian
    BC->>BC: Paymasterä»£ä»˜Gas
    BC-->>A: {txHash, status}
    deactivate BC
    
    A->>U: âœ… å®ˆæŠ¤è€…æ·»åŠ æˆåŠŸ!
```

---

##### **å›¾ 3ï¼šå»ºç«‹å…³ç³»ä¸åˆ†é…è®¿é—®ç»„ âœ…**

**æµç¨‹æè¿°**: è€äººåˆ›å»ºè®¿é—®ç»„ï¼Œé€šè¿‡é‚€è¯·æœºåˆ¶å…³è”è”ç³»äººã€‚

```mermaid
sequenceDiagram
    participant SA as è€äººApp
    participant GW as API Gateway
    participant RS as Relationship Service
    participant FA as å®¶å±/åŒ»æŠ¤App

    Note over SA: 1. è€äººåˆ›å»ºè®¿é—®ç»„
    SA->>GW: POST /api/relation/access-groups
    activate GW
    GW->>GW: éªŒè¯JWT, æå–smart_account
    GW->>RS: gRPC CreateAccessGroup
    RS->>RS: æ’å…¥access_groupsè¡¨
    RS-->>SA: {id, group_name, owner_address}
    deactivate GW
    
    Note over SA: 2. è€äººåˆ›å»ºé‚€è¯·
    SA->>GW: POST /api/relation/invitations
    GW->>RS: gRPC CreateInvitation
    RS->>RS: ç”Ÿæˆtoken, è®¾ç½®è¿‡æœŸæ—¶é—´
    RS-->>SA: {token: "inv_abc123"}
    
    SA->>SA: å°†tokenè½¬ä¸ºäºŒç»´ç æ˜¾ç¤º
    
    Note over SA,FA: 3. å®¶å±æ‰«ç /è¾“å…¥token
    FA->>GW: POST /api/relation/relationships/accept
    GW->>RS: gRPC AcceptInvitation
    activate RS
    RS->>RS: éªŒè¯tokenæœ‰æ•ˆæ€§
    RS->>RS: åˆ›å»ºuser_relationshipsè®°å½•
    RS->>RS: æ ‡è®°invitationä¸ºaccepted
    RS-->>FA: {relationship_id, access_group_id}
    deactivate RS
    
    Note over FA: å®¶å±æˆåŠŸåŠ å…¥è®¿é—®ç»„
```

---

##### **å›¾ 4ï¼šè´¦æˆ·ç¤¾äº¤æ¢å¤æµç¨‹ âœ…**

**æµç¨‹æè¿°**: ç”¨æˆ·ä¸¢å¤±ç§é’¥åï¼Œé€šè¿‡å®ˆæŠ¤è€…æŠ•ç¥¨æ¢å¤è´¦æˆ·ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(ä¸¢å¤±ç§é’¥)
    participant G1 as å®ˆæŠ¤è€…1 App
    participant G2 as å®ˆæŠ¤è€…2 App
    participant GW as API Gateway
    participant ERC as ERC4337 Service
    participant BC as åŒºå—é“¾

    Note over U,G1: åœºæ™¯ï¼šç”¨æˆ·ä¸¢å¤±ç§é’¥, è”ç³»å®ˆæŠ¤è€…
    U->>G1: è¯·æ±‚å¸®å¿™æ¢å¤è´¦æˆ·
    U->>U: ç”¨æ–°è®¾å¤‡ç”Ÿæˆæ–°çš„EOAåœ°å€
    
    Note over G1,BC: å®ˆæŠ¤è€…1å‘èµ·æ¢å¤
    G1->>GW: POST /api/erc4337/recovery/initiate/build
    GW->>ERC: {accountAddress, guardianAccountAddress, newOwnerAddress}
    ERC-->>G1: {userOp(æœªç­¾å), userOpHash}
    G1->>G1: ä½¿ç”¨å®ˆæŠ¤è€…1çš„EOAç§é’¥ç­¾å
    G1->>GW: POST /api/erc4337/recovery/submit
    GW->>ERC: {userOp(å·²ç­¾å)}
    ERC->>BC: handleOps - initiateRecovery
    BC-->>G1: âœ… æ¢å¤è¯·æ±‚å·²å‘èµ·
    
    Note over G2,BC: å®ˆæŠ¤è€…2æ”¯æŒæ¢å¤
    G2->>GW: POST /api/erc4337/recovery/support/build
    GW->>ERC: {accountAddress, guardianAccountAddress, newOwnerAddress}
    ERC-->>G2: {userOp(æœªç­¾å), userOpHash}
    G2->>G2: ä½¿ç”¨å®ˆæŠ¤è€…2çš„EOAç§é’¥ç­¾å
    G2->>GW: POST /api/erc4337/recovery/submit
    ERC->>BC: handleOps - supportRecovery
    
    Note over BC: è¾¾åˆ°é˜ˆå€¼(2/3), è‡ªåŠ¨æ‰§è¡Œæ¢å¤
    BC->>BC: æ›´æ–°ownerä¸ºnewOwnerAddress
    BC-->>U: âœ… è´¦æˆ·æ¢å¤æˆåŠŸ!
    
    U->>U: ä½¿ç”¨æ–°EOAåœ°å€ç™»å½•
```

---

##### **å›¾ 5ï¼šç”¨æˆ·ç™»å½•è®¤è¯ âœ…**

**æµç¨‹æè¿°**: åŸºäºEOAç­¾åçš„å»ä¸­å¿ƒåŒ–ç™»å½•æµç¨‹ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A as Appå®¢æˆ·ç«¯
    participant GW as API Gateway
    participant US as User Service

    U->>A: è¾“å…¥å¯†ç è§£é”æœ¬åœ°EOAé’±åŒ…
    A->>A: ä»æœ¬åœ°åŠ å¯†å­˜å‚¨è¯»å–ç§é’¥
    
    Note over A: æ„å»ºç­¾åæ¶ˆæ¯
    A->>A: ç”Ÿæˆlogin_time (å½“å‰æ—¶é—´æˆ³)
    A->>A: message = "LOGIN_TIME:${login_time}"
    A->>A: ä½¿ç”¨EOAç§é’¥ç­¾åmessage
    
    Note over A,US: æäº¤ç­¾åè¿›è¡ŒéªŒè¯
    A->>GW: POST /api/auth/login
    Note right of A: {login_time, signature}
    
    GW->>US: gRPC LoginUser
    activate US
    US->>US: æ„å»ºç›¸åŒçš„message
    US->>US: ä»signatureæ¢å¤EOAåœ°å€
    US->>US: æŸ¥è¯¢ç”¨æˆ·: findUserByEoaAddress
    US->>US: ç”ŸæˆJWT Token
    Note right of US: payload: {eoa_address, smart_account, roles}
    US-->>A: {token, user}
    deactivate US
    
    A->>A: ä¿å­˜tokenåˆ°æœ¬åœ°
    A->>U: ç™»å½•æˆåŠŸ, è¿›å…¥ä¸»ç•Œé¢
```

---

##### **å›¾ 6ï¼šå…³ç³»æš‚åœ/æ¢å¤/æ’¤é”€ âœ…**

**æµç¨‹æè¿°**: è€äººå¯ä»¥çµæ´»ç®¡ç†ä¸è”ç³»äººçš„å…³ç³»çŠ¶æ€ã€‚

```mermaid
sequenceDiagram
    participant SA as è€äººApp
    participant GW as API Gateway
    participant RS as Relationship Service
    participant FA as å®¶å±App

    Note over SA: åœºæ™¯1ï¼šæš‚åœå…³ç³»
    SA->>GW: PUT /api/relation/relationships/:id/suspend
    GW->>RS: gRPC SuspendRelationship
    RS->>RS: æ›´æ–°status = 'suspended'
    RS-->>SA: âœ… å…³ç³»å·²æš‚åœ
    RS-->>FA: æ¨é€é€šçŸ¥: "è®¿é—®æƒé™å·²æš‚åœ"
    
    Note over FA: å®¶å±æ— æ³•å†è®¿é—®å¥åº·æ•°æ®
    
    Note over SA: åœºæ™¯2ï¼šæ¢å¤å…³ç³»
    SA->>GW: PUT /api/relation/relationships/:id/resume
    GW->>RS: gRPC ResumeRelationship
    RS->>RS: æ›´æ–°status = 'active'
    RS-->>SA: âœ… å…³ç³»å·²æ¢å¤
    RS-->>FA: æ¨é€é€šçŸ¥: "è®¿é—®æƒé™å·²æ¢å¤"
    
    Note over SA: åœºæ™¯3ï¼šæ’¤é”€å…³ç³»(æ°¸ä¹…)
    SA->>GW: DELETE /api/relation/relationships/:id
    GW->>RS: gRPC RevokeRelationship
    RS->>RS: åˆ é™¤relationshipè®°å½•
    RS-->>SA: âœ… å…³ç³»å·²æ’¤é”€
    RS-->>FA: æ¨é€é€šçŸ¥: "å…³ç³»å·²è§£é™¤"
```

---

##### **å›¾ 7ï¼šè´¦æˆ·è¿ç§» (è®¾å¤‡æ›´æ¢) âœ…**

**æµç¨‹æè¿°**: ç”¨æˆ·æ›´æ¢è®¾å¤‡æ—¶çš„å®‰å…¨è´¦æˆ·è¿ç§»æµç¨‹ã€‚

```mermaid
sequenceDiagram
    participant OD as æ—§è®¾å¤‡App
    participant ND as æ–°è®¾å¤‡App
    participant GW as API Gateway
    participant MS as Migration Service

    Note over OD: åœºæ™¯ï¼šç”¨æˆ·æ›´æ¢æ‰‹æœº
    OD->>GW: POST /api/migration/create
    GW->>MS: CreateMigrationSession
    activate MS
    MS->>MS: ç”ŸæˆmigrationId
    MS->>MS: ç”Ÿæˆ6ä½confirmCode
    MS->>MS: å­˜å‚¨åˆ°migration_sessions
    MS-->>OD: {migrationId, confirmCode, expiresAt}
    deactivate MS
    
    OD->>OD: æ˜¾ç¤ºconfirmCodeå’ŒäºŒç»´ç 
    
    Note over ND: æ–°è®¾å¤‡æ‰«ç æˆ–æ‰‹åŠ¨è¾“å…¥
    ND->>GW: POST /api/migration/verify
    GW->>MS: VerifyConfirmCode
    MS->>MS: éªŒè¯confirmCode
    MS-->>ND: {valid: true, migrationId}
    
    Note over OD,ND: å»ºç«‹å®‰å…¨é€šé“ä¼ è¾“
    ND->>ND: ç”Ÿæˆæ–°çš„EOAå¯†é’¥å¯¹
    OD->>ND: ä¼ è¾“åŠ å¯†çš„æ•°æ®(é€šè¿‡äºŒç»´ç /NFC)
    
    ND->>GW: POST /api/migration/confirm
    GW->>MS: ConfirmMigration
    MS->>MS: æ›´æ–°status = 'completed'
    MS-->>ND: âœ… è¿ç§»å®Œæˆ
    
    ND->>U: åœ¨æ–°è®¾å¤‡ä¸Šç™»å½•æˆåŠŸ
```

---

#### **é˜¶æ®µäºŒï¼šè§„åˆ’ä¸­çš„ZKPæµç¨‹**

##### **å›¾ 8ï¼šæ—¥å¸¸æ‰“å¡ä¸ZKPè¯æ˜ç”Ÿæˆ ğŸš§è§„åˆ’ä¸­**

**æµç¨‹æè¿°**: è€äººæ‰“å¡åï¼Œåœ¨æœ¬åœ°ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ï¼Œç¡®ä¿éšç§ã€‚

```mermaid
sequenceDiagram
    participant SA as è€äººApp
    participant BC as åŒºå—é“¾(View)
    participant B as åç«¯æœåŠ¡
    participant FA as å®¶å±App

    Note over SA: 1. è€äººç‚¹å‡»æ‰“å¡
    SA->>SA: è·å–ç”¨è¯è®¡åˆ’ä¿¡æ¯
    SA->>SA: ç”Ÿæˆéšæœºnonce
    SA->>SA: è®¡ç®—commitment = hash(medicationId, timestamp, nonce)
    
    Note over SA: 2. ç”Ÿæˆè½»é‡çº§ZKPè¯æ˜
    SA->>SA: è°ƒç”¨ZKPç”µè·¯ç”Ÿæˆproof
    SA->>SA: å…¬å…±è¾“å…¥: commitment, timestamp
    
    Note over SA,BC: 3. å…è´¹éªŒè¯(View Call)
    SA->>BC: verifyProof(proof, publicInputs)
    BC-->>SA: true (è¯æ˜æœ‰æ•ˆ)
    
    Note over SA,B: 4. æäº¤åŠ å¯†å‡­è¯
    SA->>B: POST /api/checkin
    Note right of SA: {medicationHash, commitment, encryptedData}
    B->>B: å­˜å‚¨åˆ°checkin_credentialsè¡¨
    B-->>SA: âœ… æ‰“å¡æˆåŠŸ
    
    Note over FA,B: 5. å®¶å±æŸ¥çœ‹(éœ€è§£å¯†æƒé™)
    FA->>B: GET /api/checkin/user/:smartAccount
    B-->>FA: [{medicationHash, commitment, timestamp, encryptedData}]
    FA->>FA: ä½¿ç”¨ç§é’¥è§£å¯†encryptedData
    FA->>FA: æ˜¾ç¤º: "è¯ç‰©A - å·²æœç”¨ âœ…"
```

---

##### **å›¾ 9ï¼šå‘¨åº¦æ±‡æ€»ä¸ä¸Šé“¾ ğŸš§è§„åˆ’ä¸­**

**æµç¨‹æè¿°**: æ¯å‘¨æœ«ï¼Œå°†æ‰“å¡è®°å½•èšåˆæˆé»˜å…‹å°”æ ¹ï¼Œæäº¤ä¸Šé“¾å½¢æˆä¸å¯ç¯¡æ”¹æ¡£æ¡ˆã€‚

```mermaid
sequenceDiagram
    participant SA as è€äººApp
    participant B as åç«¯(è¯æ˜è€…+ä¸­ç»§è€…)
    participant BC as åŒºå—é“¾

    Note over SA: å‘¨æœ«è‡ªåŠ¨è§¦å‘æ±‡æ€»
    SA->>SA: æ”¶é›†æœ¬å‘¨æ‰€æœ‰commitment
    SA->>SA: leaves = [c1, c2, ..., c7]
    
    Note over SA,B: æäº¤åŸå§‹æ•°æ®
    SA->>B: POST /api/weekly-summary
    Note right of SA: {commitments: [c1,c2,...]}
    
    Note over B: åç«¯æ‰§è¡Œé‡é‡çº§ZKPè®¡ç®—
    B->>B: æ’åºå’Œå¡«å……leaves
    B->>B: è®¡ç®—Merkle Root
    B->>B: ç”Ÿæˆå‘¨åº¦æ±‡æ€»ZKPè¯æ˜
    Note right of B: è¯æ˜ï¼šæˆ‘çŸ¥é“7ä¸ªæœ‰æ•ˆcommitment<br/>ä¸”å®ƒä»¬çš„Merkle Rootæ˜¯R
    
    Note over B,BC: ä½œä¸ºä¸­ç»§è€…æäº¤ä¸Šé“¾
    B->>BC: submitWeeklySummary(proof, merkleRoot)
    activate BC
    BC->>BC: éªŒè¯proof
    BC->>BC: è®°å½•merkleRoot (æ°¸ä¹…)
    BC-->>B: {txHash}
    deactivate BC
    
    B-->>SA: {success, proof, merkleRoot, txHash}
    SA->>SA: æœ¬åœ°ä¿å­˜å®Œæ•´è¯æ˜(å¯é€‰)
    SA->>SA: æ˜¾ç¤º: "æœ¬å‘¨æ¡£æ¡ˆå·²ä¸Šé“¾ ğŸ‰"
```

---

##### **å›¾ 10ï¼šéšç§ä¿æŠ¤çš„AIåˆ†æ ğŸš§è§„åˆ’ä¸­**

**æµç¨‹æè¿°**: åˆ©ç”¨äº‘ç«¯AIç®—åŠ›ï¼ŒåŒæ—¶ç¡®ä¿æ•æ„Ÿæ•°æ®ä¸å‡ºç«¯ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(å®¶å±/åŒ»ç”Ÿ)
    participant A as App(éšç§é˜²ç«å¢™)
    participant AI as äº‘ç«¯AI

    U->>A: ç‚¹å‡»"AIå¥åº·åˆ†æ"
    
    Note over A: 1. æœ¬åœ°æ•°æ®å‡†å¤‡
    A->>A: è·å–æ‰“å¡è®°å½•
    A->>A: ä½¿ç”¨ç§é’¥è§£å¯†åŠ å¯†æ•°æ®
    
    Note over A: 2. æ•°æ®è„±æ•
    A->>A: é˜¿å¸åŒ¹æ— -> Med_A
    A->>A: å‘¨ä¸€ -> D1
    A->>A: å·²æœç”¨ -> 1
    
    Note over A,AI: 3. æäº¤åŒ¿åæ•°æ®
    A->>AI: analyze([{med:"Med_A", day:"D1", taken:1},...])
    
    Note over AI: 4. ç›²ç®—åˆ†æ
    AI->>AI: ç»Ÿè®¡åˆ†æã€æ¨¡å¼è¯†åˆ«
    AI-->>A: {trend:"weekend_dip", item:"Med_A"}
    
    Note over A: 5. æœ¬åœ°ç¿»è¯‘
    A->>A: Med_A -> é˜¿å¸åŒ¹æ—
    A->>A: ç»„ç»‡æˆè‡ªç„¶è¯­è¨€
    
    A->>U: "AIå‘ç°å¼ å¤§çˆ·çš„é˜¿å¸åŒ¹æ—<br/>åœ¨å‘¨æœ«æœè¯ä¾ä»æ€§ä¸‹é™"
```

---

#### **ç¬¬äº”éƒ¨åˆ†ï¼šæŠ€æœ¯æ ˆä¸å®ç°ç»†èŠ‚**

##### **5.1 å·²å®ç°çš„æŠ€æœ¯æ ˆ**

**å‰ç«¯ (è§„åˆ’ä¸­)**:
- Vue 3 + Capacitor (è·¨å¹³å°ç§»åŠ¨åº”ç”¨)
- ethers.js (ä»¥å¤ªåŠäº¤äº’)
- TypeScript

**åç«¯å¾®æœåŠ¡**:
- Node.js + Express (API Gateway)
- gRPC (å¾®æœåŠ¡é€šä¿¡)
- PostgreSQL (å…³ç³»æ•°æ®åº“)
- Redis (ç¼“å­˜/ä¼šè¯/ä»»åŠ¡çŠ¶æ€)
- RabbitMQ (æ¶ˆæ¯é˜Ÿåˆ—/äº‹ä»¶é©±åŠ¨)
- WebSocket (å®æ—¶é€šçŸ¥æ¨é€)

**åŒºå—é“¾**:
- Solidity (æ™ºèƒ½åˆçº¦)
- ERC4337 æ ‡å‡† (è´¦æˆ·æŠ½è±¡)
- Hardhat (å¼€å‘ç¯å¢ƒ)
- ethers.js (é“¾äº¤äº’)

##### **5.2 è§„åˆ’ä¸­çš„æŠ€æœ¯æ ˆ**

**é›¶çŸ¥è¯†è¯æ˜** âœ…:
- Circom (ZKPç”µè·¯å¼€å‘)
- SnarkJS (è¯æ˜ç”Ÿæˆ/éªŒè¯) - å·²é›†æˆ
- Groth16 (è¯æ˜ç³»ç»Ÿ) - å·²å®ç°
- å¼‚æ­¥ä»»åŠ¡å¤„ç† (åç«¯é‡é‡çº§è®¡ç®—)

**åŠ å¯†**:
- ECIES (éå¯¹ç§°åŠ å¯†)
- AES-256-GCM (å¯¹ç§°åŠ å¯†)
- Keccak-256 (å“ˆå¸Œå‡½æ•°)

##### **5.3 ç³»ç»Ÿå®‰å…¨ç‰¹æ€§**

1. **ç§é’¥å®‰å…¨** âœ…:
   - ç§é’¥æ°¸ä¸ä¸Šä¼ æœåŠ¡å™¨
   - æœ¬åœ°åŠ å¯†å­˜å‚¨
   - ä¸¤æ­¥å¼ç­¾åæµç¨‹

2. **é›¶Gasè´¹ç”¨** âœ…:
   - Paymasterä»£ä»˜æ‰€æœ‰äº¤æ˜“
   - ç”¨æˆ·æ— éœ€æŒæœ‰ETH

3. **ç¤¾äº¤æ¢å¤** âœ…:
   - æ— éœ€åŠ©è®°è¯
   - å®ˆæŠ¤è€…æŠ•ç¥¨æœºåˆ¶
   - é˜ˆå€¼å¯é…ç½®

4. **ç»†ç²’åº¦æƒé™** âœ…:
   - è®¿é—®ç»„éš”ç¦»
   - å…³ç³»å¯æš‚åœ/æ¢å¤
   - å®æ—¶æƒé™å˜æ›´

5. **é›¶çŸ¥è¯†è¯æ˜** ğŸš§:
   - æ•°æ®æ‰€æœ‰æƒ
   - éšç§ä¿æŠ¤
   - å¯éªŒè¯è®¡ç®—

##### **5.4 æ•°æ®åº“è¿æ¥é…ç½®**

```
PostgreSQL (ç«¯å£ 5400):
- bs_gateway_db (ç½‘å…³æƒé™)
- bs_user_service_db (ç”¨æˆ·æœåŠ¡)
- bs_relationship_db (å…³ç³»æœåŠ¡)
- bs_userinfo_db (ä¸ªäººæ¡£æ¡ˆ)
- bs_secure_exchange_db (å®‰å…¨äº¤æ¢)
- bs_medication_db (ç”¨è¯ç®¡ç†) âœ… æ–°å¢
- migration_db (è¿ç§»æœåŠ¡)
- bs_notification_db (é€šçŸ¥æœåŠ¡)

Redis (ç«¯å£ 6379):
- ä¼šè¯ç¼“å­˜
- Tokené»‘åå•
- WebSocketåœ¨çº¿çŠ¶æ€
- ZKPä»»åŠ¡çŠ¶æ€
- Medication Serviceç¼“å­˜

RabbitMQ (ç«¯å£ 5672):
- æœåŠ¡é—´å¼‚æ­¥é€šä¿¡
- é€šçŸ¥äº‹ä»¶åˆ†å‘ï¼ˆTopic Exchangeï¼‰
- ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆhigh/normal/lowï¼‰
- ç”¨è¯è®¡åˆ’åŠ å¯†ä¼ è¾“
```

---

#### **ç¬¬å…­éƒ¨åˆ†ï¼šAPIæ¥å£æ€»è§ˆ**

##### **6.1 å…¬å¼€æ¥å£ (æ— éœ€è®¤è¯)**

**ç”¨æˆ·è®¤è¯**:
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•

**ERC4337æœåŠ¡**:
- `POST /api/erc4337/account` - åˆ›å»ºè´¦æˆ·
- `POST /api/erc4337/account/address` - é¢„è®¡ç®—åœ°å€
- `POST /api/erc4337/guardian/build` - æ„å»ºæ·»åŠ å®ˆæŠ¤è€…UserOp
- `POST /api/erc4337/guardian/submit` - æäº¤å·²ç­¾åUserOp
- `POST /api/erc4337/recovery/initiate/build` - æ„å»ºå‘èµ·æ¢å¤UserOp
- `POST /api/erc4337/recovery/support/build` - æ„å»ºæ”¯æŒæ¢å¤UserOp
- `POST /api/erc4337/recovery/submit` - æäº¤æ¢å¤UserOp
- `GET /api/erc4337/guardian/:address` - æŸ¥è¯¢å®ˆæŠ¤è€…

**ä¸ªäººæ¡£æ¡ˆ**:
- `GET /api/userinfo/api/persons/lookup` - èº«ä»½éªŒè¯æŸ¥è¯¢

**è´¦æˆ·è¿ç§»**:
- `POST /api/migration/create` - åˆ›å»ºè¿ç§»ä¼šè¯
- `POST /api/migration/verify` - éªŒè¯ç¡®è®¤ç 
- `POST /api/migration/confirm` - ç¡®è®¤è¿ç§»

##### **6.2 å—ä¿æŠ¤æ¥å£ (éœ€è¦JWTè®¤è¯)**

**é€šçŸ¥æœåŠ¡** âœ…:
- `GET /api/notification/notifications` - è·å–é€šçŸ¥åˆ—è¡¨
- `GET /api/notification/notifications/unread/count` - è·å–æœªè¯»æ•°é‡
- `PUT /api/notification/notifications/:id/read` - æ ‡è®°å·²è¯»
- `PUT /api/notification/notifications/read-all` - å…¨éƒ¨æ ‡è®°å·²è¯»
- `DELETE /api/notification/notifications/:id` - åˆ é™¤é€šçŸ¥
- `WS /ws/notification` - WebSocketå®æ—¶æ¨é€ï¼ˆéœ€JWTè®¤è¯ï¼‰

**ZKPæœåŠ¡** âœ…:
- `POST /api/zkp/prove/weekly-summary` - å¯åŠ¨å‘¨åº¦æ±‡æ€»è¯æ˜ä»»åŠ¡
- `GET /api/zkp/proof-status/:jobId` - æŸ¥è¯¢è¯æ˜ä»»åŠ¡çŠ¶æ€
- `GET /api/zkp/health` - ZKPæœåŠ¡å¥åº·æ£€æŸ¥

**ç”¨è¯ç®¡ç†æœåŠ¡** âœ…:
- `GET /api/medication/categories` - è·å–è¯ç‰©åˆ†ç±»åˆ—è¡¨
- `GET /api/medication/common` - æœç´¢å¸¸ç”¨è¯ç‰©ï¼ˆæ”¯æŒsearchã€categoryå‚æ•°ï¼‰
- `POST /api/medication/plans` - åˆ›å»ºç”¨è¯è®¡åˆ’ï¼ˆåŒ»ç”Ÿï¼‰
- `GET /api/medication/plans/:planId` - æŸ¥è¯¢è®¡åˆ’è¯¦æƒ…
- `GET /api/medication/plans/patient/:address` - æŸ¥è¯¢æ‚£è€…çš„æ‰€æœ‰è®¡åˆ’
- `GET /api/medication/plans/doctor/:address` - æŸ¥è¯¢åŒ»ç”Ÿåˆ›å»ºçš„è®¡åˆ’
- `PUT /api/medication/plans/:planId` - æ›´æ–°ç”¨è¯è®¡åˆ’ï¼ˆåŒ»ç”Ÿï¼‰
- `DELETE /api/medication/plans/:planId` - åˆ é™¤ç”¨è¯è®¡åˆ’
- `POST /api/medication/plans/:planId/share` - è€äººåˆ†äº«è®¡åˆ’åˆ°è®¿é—®ç»„
- `DELETE /api/medication/plans/:planId/share/:recipientAddress` - æ’¤é”€åˆ†äº«
- `GET /api/medication/plans/:planId/share-status` - æŸ¥è¯¢åˆ†äº«çŠ¶æ€

**è®¿é—®ç»„ç®¡ç†**:
- `POST /api/relation/access-groups` - åˆ›å»ºè®¿é—®ç»„
- `GET /api/relation/access-groups` - è·å–æˆ‘çš„è®¿é—®ç»„
- `GET /api/relation/access-groups/stats` - è·å–è®¿é—®ç»„è¯¦æƒ…
- `GET /api/relation/access-groups/:id/members` - è·å–æˆå‘˜åˆ—è¡¨

**é‚€è¯·ç®¡ç†**:
- `POST /api/relation/invitations` - åˆ›å»ºæ ‡å‡†é‚€è¯·
- `POST /api/relation/invitations/hospital` - åˆ›å»ºåŒ»é™¢é‚€è¯·
- `GET /api/relation/invitations/my` - è·å–æˆ‘çš„é‚€è¯·
- `DELETE /api/relation/invitations/cancel` - å–æ¶ˆé‚€è¯·

**å…³ç³»ç®¡ç†**:
- `POST /api/relation/relationships/accept` - æ¥å—é‚€è¯·
- `PUT /api/relation/relationships/:id/suspend` - æš‚åœå…³ç³»
- `PUT /api/relation/relationships/:id/resume` - æ¢å¤å…³ç³»
- `DELETE /api/relation/relationships/:id` - æ’¤é”€å…³ç³»

##### **6.3 è§„åˆ’ä¸­çš„æ¥å£**

**ç”¨è¯æ‰“å¡** ğŸš§:
- `POST /api/checkin` - æäº¤æ‰“å¡å‡­è¯
- `GET /api/checkin/user/:smartAccount` - æŸ¥è¯¢æ‰“å¡è®°å½•
- `GET /api/checkin/verify` - éªŒè¯æ‰“å¡è¯æ˜

**å‘¨åº¦æ±‡æ€»** ğŸš§:
- `POST /api/weekly-summary` - æäº¤å‘¨åº¦æ±‡æ€»
- `GET /api/weekly-summary/:smartAccount` - æŸ¥è¯¢ä¸Šé“¾è®°å½•

---

#### **ç¬¬ä¸ƒéƒ¨åˆ†ï¼šéƒ¨ç½²ä¸è¿ç»´**

##### **7.1 æœåŠ¡å¯åŠ¨é¡ºåº**

```bash
# 1. åŸºç¡€è®¾æ–½
docker-compose up -d postgres redis rabbitmq

# 2. åŒºå—é“¾èŠ‚ç‚¹
cd smart-contracts && npx hardhat node

# 3. åç«¯æœåŠ¡
./start-all-services.ps1

# æˆ–æ‰‹åŠ¨å¯åŠ¨:
cd api-gateway && npm start         # 3000 (HTTP Gateway)
cd user-service && npm start        # 3001 (HTTP) + 50051 (gRPC)
cd erc4337-service && npm start     # 3002 (HTTP) + 50053 (gRPC)
cd zkp-service && npm start         # 3003 (HTTP)
cd relationship-service && npm start # 3004 (HTTP) + 50052 (gRPC)
cd notification-service && npm start # 3005 (HTTP + WebSocket)
cd secure-exchange-service && npm start # 3006 (HTTP) + 50056 (gRPC)
cd medication-service && npm start  # 3007 (HTTP) + 50057 (gRPC) âœ… æ–°å¢
cd migration-service && npm start   # 3008 (HTTP)
cd userinfo-service && npm start    # 5000 (HTTP)

# 4. å‰ç«¯åº”ç”¨ (è§„åˆ’ä¸­)
cd mobile-app && npm run dev
```

##### **7.2 å¥åº·æ£€æŸ¥**

```bash
# API Gateway
curl http://localhost:3000/health

# User Service
curl http://localhost:3001/api/health

# ERC4337 Service
curl http://localhost:3002/health

# ZKP Service
curl http://localhost:3003/api/health

# Relationship Service
curl http://localhost:3004/api/health

# Notification Service
curl http://localhost:3005/api/health

# Secure Exchange Service
curl http://localhost:3006/api/health

# Medication Service âœ… æ–°å¢
curl http://localhost:3007/api/health

# Migration Service
curl http://localhost:3008/health

# Userinfo Service
curl http://localhost:5000/health
```

##### **7.3 ç›‘æ§æŒ‡æ ‡**

**æ€§èƒ½æŒ‡æ ‡**:
- APIå“åº”æ—¶é—´ < 200ms
- gRPCè°ƒç”¨å»¶è¿Ÿ < 50ms
- åŒºå—é“¾äº¤æ˜“ç¡®è®¤ < 15s

**å¯ç”¨æ€§æŒ‡æ ‡**:
- æœåŠ¡å¯ç”¨æ€§ > 99.9%
- æ•°æ®åº“è¿æ¥æ± åˆ©ç”¨ç‡ < 80%
- Redisç¼“å­˜å‘½ä¸­ç‡ > 90%

---

#### **ç¬¬å…«éƒ¨åˆ†ï¼šæµ‹è¯•ä¸éªŒè¯**

##### **8.1 å·²å®Œæˆçš„æµ‹è¯•**

**E2Eæµ‹è¯•** âœ…:
- å®Œæ•´å…³ç³»ç®¡ç†æµç¨‹æµ‹è¯•
  - ä½ç½®: `api-gateway/tests/e2e-relationship-flow.test.js`
  - è¦†ç›–: è®¿é—®ç»„ã€é‚€è¯·ã€å…³ç³»ç®¡ç†å…¨æµç¨‹
- é€šçŸ¥æœåŠ¡é›†æˆæµ‹è¯•
  - ä½ç½®: `api-gateway/tests/e2e-notification-flow.test.js`
  - è¦†ç›–: WebSocketæ¨é€ã€HTTP APIã€æ¶ˆæ¯é˜Ÿåˆ—
- å®‰å…¨ä¼ è¾“æœåŠ¡é›†æˆæµ‹è¯•
  - ä½ç½®: `api-gateway/tests/e2e-secure-exchange-flow.test.js`
  - è¦†ç›–: ç«¯åˆ°ç«¯åŠ å¯†æ•°æ®ä¼ è¾“ã€å…¬é’¥äº¤æ¢
- ç”¨è¯ç®¡ç†æœåŠ¡é›†æˆæµ‹è¯• âœ… æ–°å¢
  - ä½ç½®: `api-gateway/tests/e2e-medication-flow.test.js`
  - è¦†ç›–: è¯ç‰©æœç´¢ã€è®¡åˆ’ç®¡ç†ã€åŠ å¯†åˆ†äº«ã€çŠ¶æ€ç®¡ç†ã€æé†’åŠŸèƒ½
- ZKPæœåŠ¡é›†æˆæµ‹è¯•
  - ä½ç½®: `zkp-service/tests/test-zkp-integration.js`
  - è¦†ç›–: è¯æ˜ç”Ÿæˆã€ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ã€è®¤è¯æµ‹è¯•

**APIæµ‹è¯•** âœ…:
- HTTPæµ‹è¯•æ–‡ä»¶: `*/httpTest/*.http`
- ä½¿ç”¨VS Code REST Clientæ’ä»¶æ‰§è¡Œ

**æ€§èƒ½æµ‹è¯•** âœ…:
- ZKPè¯æ˜ç”Ÿæˆ: weeklySummaryç”µè·¯æµ‹è¯•é€šè¿‡
- WebSocketå¹¶å‘è¿æ¥æµ‹è¯•é€šè¿‡

##### **8.2 è§„åˆ’ä¸­çš„æµ‹è¯•**

**ZKPæ€§èƒ½æµ‹è¯•** ğŸš§:
- è½»é‡çº§è¯æ˜ç”Ÿæˆæ—¶é—´ (ç›®æ ‡: < 5s)
- é‡é‡çº§è¯æ˜ç”Ÿæˆæ—¶é—´ (æœåŠ¡å™¨ç«¯)
- ç§»åŠ¨è®¾å¤‡æ€§èƒ½åŸºå‡†æµ‹è¯•

**å®‰å…¨æµ‹è¯•** ğŸš§:
- ç­¾åé‡æ”¾æ”»å‡»é˜²æŠ¤
- æƒé™è¶Šæƒæµ‹è¯•
- åŠ å¯†å¼ºåº¦éªŒè¯

---

#### **ç¬¬ä¹éƒ¨åˆ†ï¼šé¡¹ç›®è¿›åº¦ä¸é‡Œç¨‹ç¢‘**

##### **9.1 Phase 1: åŸºç¡€è®¾æ–½ä¸èº«ä»½å±‚ âœ… å·²å®Œæˆ**

**å®Œæˆæ—¶é—´**: 2025å¹´10æœˆä¸­æ—¬
**å®ŒæˆåŠŸèƒ½**:
- [x] ERC4337è´¦æˆ·æŠ½è±¡ç³»ç»Ÿ
- [x] ç¤¾äº¤æ¢å¤æœºåˆ¶ï¼ˆå®ˆæŠ¤è€…ç®¡ç†ã€è´¦æˆ·æ¢å¤ï¼‰
- [x] ç”¨æˆ·è®¤è¯ä¸æˆæƒï¼ˆJWT + RBACï¼‰
- [x] è®¿é—®ç»„æƒé™ç®¡ç†ï¼ˆç»†ç²’åº¦æƒé™æ§åˆ¶ï¼‰
- [x] å…³ç³»ç®¡ç†ç³»ç»Ÿï¼ˆé‚€è¯·ã€æš‚åœã€æ¢å¤ã€æ’¤é”€ï¼‰
- [x] è´¦æˆ·è¿ç§»æœåŠ¡ï¼ˆè®¾å¤‡é—´å®‰å…¨è¿ç§»ï¼‰
- [x] ä¸ªäººæ¡£æ¡ˆæœåŠ¡ï¼ˆèº«ä»½éªŒè¯ï¼‰
- [x] å¾®æœåŠ¡æ¶æ„æ­å»ºï¼ˆ9ä¸ªå¾®æœåŠ¡ï¼‰
- [x] API Gatewayç»Ÿä¸€å…¥å£ï¼ˆæ”¯æŒWebSocketä»£ç†ï¼‰
- [x] æ¶ˆæ¯é€šçŸ¥æœåŠ¡ï¼ˆWebSocket + RabbitMQ + å¤šæ¸ é“æ¨é€ï¼‰
- [x] ZKPè¯æ˜ç”ŸæˆæœåŠ¡ï¼ˆåç«¯å¼‚æ­¥è®¡ç®—ï¼‰
- [x] å®‰å…¨æ•°æ®ä¼ è¾“æœåŠ¡ï¼ˆç«¯åˆ°ç«¯åŠ å¯†ï¼‰
- [x] å®Œæ•´çš„E2Eæµ‹è¯•å¥—ä»¶ï¼ˆ4ä¸ªæµç¨‹æµ‹è¯•ï¼‰

##### **9.2 Phase 2: åº”ç”¨å±‚ä¸æ•°æ®ç®¡ç† âœ… éƒ¨åˆ†å®Œæˆ / ğŸš§ è¿›è¡Œä¸­**

**å®Œæˆæ—¶é—´**: 2025å¹´10æœˆä¸‹æ—¬å¼€å§‹
**å·²å®Œæˆ** âœ…:
- [x] ZKPè¯æ˜ç”ŸæˆæœåŠ¡ï¼ˆåç«¯å¼‚æ­¥è®¡ç®—ï¼‰
- [x] weeklySummaryç”µè·¯é›†æˆæµ‹è¯•
- [x] **ç”¨è¯ç®¡ç†ç³»ç»Ÿ** âœ… æ–°å®Œæˆ (2025å¹´10æœˆ30æ—¥)
  - [x] å¸¸ç”¨è¯ç‰©åº“ï¼ˆ150ç§è¯ç‰©ï¼Œ9å¤§åˆ†ç±»ï¼‰
  - [x] ç”¨è¯è®¡åˆ’ç®¡ç†ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
  - [x] è¯ç‰©æ¡ç›®ç®¡ç†ï¼ˆæ”¯æŒå¤šè¯ç‰©è®¡åˆ’ï¼‰
  - [x] è®¡åˆ’åŠ å¯†åˆ†äº«åŠŸèƒ½ï¼ˆåŸºäºè®¿é—®ç»„ï¼‰
  - [x] ä¸Secure Exchange Serviceé›†æˆï¼ˆç«¯åˆ°ç«¯åŠ å¯†ä¼ è¾“ï¼‰
  - [x] è®¡åˆ’çŠ¶æ€ç®¡ç†ï¼ˆactive/paused/completed/cancelledï¼‰
  - [x] å®Œæ•´çš„E2Eæµ‹è¯•ï¼ˆ1028è¡Œæµ‹è¯•ä»£ç ï¼‰
  - [x] API Gatewayé›†æˆå’Œè·¯ç”±é…ç½®
- [x] å®‰å…¨æ•°æ®ä¼ è¾“åŸºç¡€è®¾æ–½
- [x] åŠ å¯†å¯†é’¥äº¤æ¢æœºåˆ¶

**è¿›è¡Œä¸­** ğŸš§:
- [ ] å‰ç«¯ZKPç”µè·¯é›†æˆï¼ˆè½»é‡çº§ï¼‰
- [ ] ç”¨è¯æ‰“å¡è¯æ˜ç”Ÿæˆï¼ˆå®¢æˆ·ç«¯ï¼‰
- [ ] ç”¨è¯æé†’æ¨é€åŠŸèƒ½
- [ ] ç”¨è¯è®°å½•å’Œä¾ä»æ€§ç»Ÿè®¡
- [ ] å‘¨åº¦æ±‡æ€»ä¸Šé“¾ï¼ˆERC4337é›†æˆï¼‰
- [ ] ç§»åŠ¨ç«¯ZKPæ€§èƒ½ä¼˜åŒ–

**å¾…å¼€å§‹** ğŸ“‹:
- [ ] ç§»åŠ¨ç«¯Appå¼€å‘ï¼ˆVue + Capacitorï¼‰
- [ ] ç”¨è¯æ‰“å¡UIç•Œé¢

##### **9.3 Phase 3: åº”ç”¨å±‚ä¸AI ğŸš§ æœªæ¥è®¡åˆ’**

**é¢„è®¡æ—¶é—´**: 2026å¹´2æœˆ - 2026å¹´6æœˆ
**è§„åˆ’åŠŸèƒ½**:
- [ ] ç§»åŠ¨Appå¼€å‘ (Vue + Capacitor)
- [ ] ç”¨è¯æ–¹æ¡ˆç®¡ç†
- [ ] å®æ—¶æé†’ä¸è­¦æŠ¥
- [ ] éšç§ä¿æŠ¤çš„AIåˆ†æ
- [ ] æ•°æ®å¯è§†åŒ–

##### **9.4 Phase 4: ç”Ÿæ€ä¸æ¨å¹¿ ğŸš§ æœªæ¥è®¡åˆ’**

**é¢„è®¡æ—¶é—´**: 2026å¹´7æœˆèµ·
**è§„åˆ’åŠŸèƒ½**:
- [ ] åŒ»é™¢ç³»ç»Ÿå¯¹æ¥
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] å»ä¸­å¿ƒåŒ–å­˜å‚¨ (IPFS)
- [ ] è·¨é“¾äº’æ“ä½œ
- [ ] ç¤¾åŒºæ²»ç†

---

#### **ç¬¬åéƒ¨åˆ†ï¼šæŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ**

##### **10.1 å·²è§£å†³çš„æŠ€æœ¯æŒ‘æˆ˜**

**æŒ‘æˆ˜1: ç§é’¥å®‰å…¨é—®é¢˜**
- **é—®é¢˜**: å¦‚ä½•åœ¨ä¸ä¸Šä¼ ç§é’¥çš„æƒ…å†µä¸‹æ‰§è¡Œé“¾ä¸Šæ“ä½œ?
- **è§£å†³**: é‡‡ç”¨ä¸¤æ­¥å¼æµç¨‹ (build + sign + submit)
- **çŠ¶æ€**: âœ… å·²å®ç°

**æŒ‘æˆ˜2: Gasè´¹ç”¨éšœç¢**
- **é—®é¢˜**: è€å¹´ç”¨æˆ·ä¸æ‡‚å¾—å¦‚ä½•è·å–ETHæ”¯ä»˜Gas?
- **è§£å†³**: Paymasterä»£ä»˜æ‰€æœ‰äº¤æ˜“è´¹ç”¨
- **çŠ¶æ€**: âœ… å·²å®ç°

**æŒ‘æˆ˜3: åŠ©è®°è¯æ˜“ä¸¢å¤±**
- **é—®é¢˜**: è€å¹´äººå®¹æ˜“å¿˜è®°åŠ©è®°è¯å¯¼è‡´è´¦æˆ·æ°¸ä¹…ä¸¢å¤±?
- **è§£å†³**: ç¤¾äº¤æ¢å¤æœºåˆ¶ï¼Œé€šè¿‡å®ˆæŠ¤è€…æ¢å¤è´¦æˆ·
- **çŠ¶æ€**: âœ… å·²å®ç°

**æŒ‘æˆ˜4: æƒé™ç®¡ç†å¤æ‚**
- **é—®é¢˜**: å¦‚ä½•å®ç°ç»†ç²’åº¦çš„æ•°æ®è®¿é—®æ§åˆ¶?
- **è§£å†³**: è®¿é—®ç»„ + é‚€è¯·æœºåˆ¶ + å…³ç³»çŠ¶æ€ç®¡ç†
- **çŠ¶æ€**: âœ… å·²å®ç°

##### **10.2 å¾…è§£å†³çš„æŠ€æœ¯æŒ‘æˆ˜**

**æŒ‘æˆ˜5: ç§»åŠ¨ç«¯ZKPæ€§èƒ½**
- **é—®é¢˜**: ç§»åŠ¨è®¾å¤‡ç”ŸæˆZKPè¯æ˜å¯èƒ½è€—æ—¶è¿‡é•¿
- **æ–¹æ¡ˆ**: 
  - è½»é‡çº§è¯æ˜åœ¨å®¢æˆ·ç«¯ç”Ÿæˆ (< 5s) - ğŸš§ å¾…å®ç°
  - é‡é‡çº§è¯æ˜åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆ - âœ… å·²å®ç°
  - å¼‚æ­¥ä»»åŠ¡å¤„ç† + å®æ—¶é€šçŸ¥
- **çŠ¶æ€**: âœ… æœåŠ¡ç«¯å·²å®Œæˆ

**æŒ‘æˆ˜6: é“¾ä¸‹æ•°æ®å¯ä¿¡æ€§**
- **é—®é¢˜**: åç«¯å­˜å‚¨çš„åŠ å¯†å‡­è¯å¯èƒ½è¢«ç¯¡æ”¹?
- **æ–¹æ¡ˆ**: 
  - å®šæœŸæ‰¹é‡ä¸Šé“¾
  - é»˜å…‹å°”è¯æ˜éªŒè¯
- **çŠ¶æ€**: ğŸš§ è®¾è®¡ä¸­

---

#### **ç¬¬åä¸€éƒ¨åˆ†ï¼šå®‰å…¨æ¨¡å‹åˆ†æ**

##### **11.1 å¨èƒæ¨¡å‹**

**å‡è®¾çš„æ”»å‡»è€…èƒ½åŠ›**:
1. æ”»å‡»è€…å¯ä»¥å®Œå…¨æ§åˆ¶åç«¯æœåŠ¡å™¨
2. æ”»å‡»è€…å¯ä»¥ç›‘å¬æ‰€æœ‰ç½‘ç»œæµé‡
3. æ”»å‡»è€…ä¸èƒ½ç ´è§£å¯†ç å­¦åŸè¯­ (ECC, AES, Hash)
4. æ”»å‡»è€…ä¸èƒ½ç‰©ç†è®¿é—®ç”¨æˆ·è®¾å¤‡

##### **11.2 å®‰å…¨ä¿è¯**

**å·²å®ç°çš„å®‰å…¨ä¿è¯** âœ…:

1. **èº«ä»½å®‰å…¨**: 
   - ç§é’¥æ°¸ä¸ç¦»å¼€è®¾å¤‡
   - åŸºäºç­¾åçš„èº«ä»½éªŒè¯
   - ç¤¾äº¤æ¢å¤é˜²æ­¢è´¦æˆ·ä¸¢å¤±

2. **ä¼ è¾“å®‰å…¨**:
   - HTTPS/TLSåŠ å¯†
   - ç­¾åéªŒè¯é˜²æ­¢ä¸­é—´äººæ”»å‡»

3. **æƒé™å®‰å…¨**:
   - JWT Tokenæœ‰æ•ˆæœŸé™åˆ¶
   - ç»†ç²’åº¦è®¿é—®æ§åˆ¶
   - å®æ—¶æƒé™æ’¤é”€

4. **åˆçº¦å®‰å…¨**:
   - å®ˆæŠ¤è€…é˜ˆå€¼æœºåˆ¶
   - æ¢å¤æ—¶é—´é”
   - Paymasteré¢åº¦é™åˆ¶

**è§„åˆ’ä¸­çš„å®‰å…¨ä¿è¯** ğŸš§:

5. **æ•°æ®éšç§** (ZKPå±‚):
   - é›¶çŸ¥è¯†è¯æ˜éšè—åŸå§‹æ•°æ®
   - ç«¯åˆ°ç«¯åŠ å¯†é˜²æ­¢æœªæˆæƒè®¿é—®
   - å³ä½¿æœåŠ¡å™¨è¢«æ”»ç ´ï¼Œä¹Ÿæ— æ³•è¯»å–å¥åº·æ•°æ®

6. **æ•°æ®å®Œæ•´æ€§** (åŒºå—é“¾å±‚):
   - å‘¨åº¦æ±‡æ€»ä¸Šé“¾é˜²ç¯¡æ”¹
   - é»˜å…‹å°”è¯æ˜éªŒè¯å†å²è®°å½•

---

#### **ç¬¬åäºŒéƒ¨åˆ†ï¼šç»“è®ºä¸å±•æœ›**

##### **12.1 é¡¹ç›®æˆæœæ€»ç»“**

æœ¬é¡¹ç›®æˆåŠŸæ­å»ºäº†ä¸€ä¸ª**å®Œæ•´çš„å»ä¸­å¿ƒåŒ–èº«ä»½ä¸æƒé™ç®¡ç†åŸºç¡€è®¾æ–½**ï¼Œå¹¶å®Œæˆäº†**ç”¨è¯ç®¡ç†æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ**ï¼Œä¸ºéšç§ä¿æŠ¤çš„å¥åº·æ•°æ®ç®¡ç†å¥ å®šäº†åšå®åŸºç¡€ï¼š

**âœ… æŠ€æœ¯åˆ›æ–°**:
1. é¦–ä¸ªå°†ERC4337è´¦æˆ·æŠ½è±¡åº”ç”¨äºåŒ»ç–—åœºæ™¯çš„å®è·µ
2. é›¶Gasè´¹ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œé™ä½Web3ä½¿ç”¨é—¨æ§›
3. ç¤¾äº¤æ¢å¤æœºåˆ¶ï¼Œè§£å†³è€å¹´äººåŠ©è®°è¯ç®¡ç†éš¾é¢˜
4. ç»†ç²’åº¦è®¿é—®ç»„æƒé™ç³»ç»Ÿï¼Œå®ç°ç²¾å‡†æ•°æ®å…±äº«
5. ç«¯åˆ°ç«¯åŠ å¯†çš„ç”¨è¯è®¡åˆ’ä¼ è¾“ï¼Œä¿æŠ¤åŒ»ç–—éšç§ âœ… æ–°å¢

**âœ… æ¶æ„ä¼˜åŠ¿**:
1. å¾®æœåŠ¡æ¶æ„ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ï¼ˆå·²å®Œæˆ9ä¸ªæ ¸å¿ƒå¾®æœåŠ¡ï¼‰
2. å‰åç«¯åˆ†ç¦»ï¼Œæ¸…æ™°çš„èŒè´£åˆ’åˆ†
3. å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œçºµæ·±é˜²å¾¡
4. æ ‡å‡†åŒ–APIæ¥å£ï¼Œæ˜“äºé›†æˆ
5. å®Œæ•´çš„E2Eæµ‹è¯•è¦†ç›–ï¼ˆ4ä¸ªå®Œæ•´æµç¨‹æµ‹è¯•ï¼‰ âœ… æ–°å¢

**âœ… å®ç”¨ä»·å€¼**:
1. çœŸæ­£çš„ç”¨æˆ·æ•°æ®ä¸»æƒ
2. å¯ä¿¡çš„å¥åº·è®°å½•è¯æ˜
3. çµæ´»çš„æƒé™ç®¡ç†
4. æ— ç¼çš„è´¦æˆ·æ¢å¤
5. å®Œæ•´çš„ç”¨è¯è®¡åˆ’ç®¡ç†ï¼ˆ150ç§å¸¸ç”¨è¯ç‰©åº“ï¼‰ âœ… æ–°å¢
6. è€äººä¸»å¯¼çš„éšç§æ§åˆ¶ï¼ˆä¸»åŠ¨åˆ†äº«æœºåˆ¶ï¼‰ âœ… æ–°å¢

**âœ… æœ€æ–°é‡Œç¨‹ç¢‘ (2025å¹´10æœˆ31æ—¥)**:
- å®Œæˆç”¨è¯ç®¡ç†ç³»ç»Ÿï¼ˆMedication Serviceï¼‰
- å®ç°150ç§å¸¸ç”¨è¯ç‰©æ•°æ®åº“
- é›†æˆç«¯åˆ°ç«¯åŠ å¯†æ•°æ®ä¼ è¾“
- å®Œæˆ1028è¡ŒE2Eæµ‹è¯•ä»£ç 
- æ”¯æŒåŒ»ç”Ÿ-æ‚£è€…-å®¶å±ä¸‰æ–¹åä½œ
- å®ç°åŸºäºè®¿é—®ç»„çš„è®¡åˆ’åˆ†äº«æœºåˆ¶

##### **12.2 ä¸‹ä¸€æ­¥è®¡åˆ’**

**çŸ­æœŸ (1-3ä¸ªæœˆå†…)**:
1. âœ… ~~å®Œæˆç”¨è¯ç®¡ç†ç³»ç»Ÿåç«¯~~ **å·²å®Œæˆ**
2. å®Œæˆç§»åŠ¨ç«¯Appå¼€å‘ï¼ˆVue + Capacitorï¼‰
3. å®ç°ç”¨è¯æé†’æ¨é€åŠŸèƒ½
4. å¼€å‘ç”¨è¯æ‰“å¡UIç•Œé¢
5. å®ç°è½»é‡çº§ZKPæ‰“å¡åŠŸèƒ½ï¼ˆå®¢æˆ·ç«¯ï¼‰
6. å®Œå–„ç”¨è¯è®°å½•å’Œä¾ä»æ€§ç»Ÿè®¡
7. è¿›è¡Œå°è§„æ¨¡ç”¨æˆ·æµ‹è¯•

**ä¸­æœŸ (3-9ä¸ªæœˆ)**:
1. å®ç°å‘¨åº¦æ±‡æ€»ä¸Šé“¾
2. å¼€å‘AIå¥åº·åˆ†æåŠŸèƒ½ï¼ˆéšç§ä¿æŠ¤ï¼‰
3. å¯¹æ¥è¯•ç‚¹åŒ»é™¢ç³»ç»Ÿ
4. å®Œå–„ç›‘æ§ä¸è¿ç»´ä½“ç³»
5. è¯ç‰©ç›¸äº’ä½œç”¨æ£€æŸ¥åŠŸèƒ½
6. ç”¨è¯è®°å½•æ•°æ®åˆ†æä¸å¯è§†åŒ–

**é•¿æœŸ (1-2å¹´)**:
1. æ¨å¹¿åˆ°æ›´å¤šåŒ»ç–—æœºæ„
2. ç ”ç©¶è·¨é“¾äº’æ“ä½œæ–¹æ¡ˆ
3. æ¢ç´¢å»ä¸­å¿ƒåŒ–å­˜å‚¨ï¼ˆIPFSé›†æˆï¼‰
4. å»ºè®¾å¼€å‘è€…ç”Ÿæ€
5. å¤šè¯­è¨€å›½é™…åŒ–æ”¯æŒ

##### **12.3 ç¤¾ä¼šå½±å“**

æœ¬é¡¹ç›®çš„æˆåŠŸå®æ–½å°†äº§ç”Ÿæ·±è¿œçš„ç¤¾ä¼šå½±å“ï¼š

1. **æå‡è€é¾„åŒ–ç¤¾ä¼šçš„åŒ»ç–—è´¨é‡**: é€šè¿‡æŠ€æœ¯æ‰‹æ®µè§£å†³ç”¨è¯ä¾ä»æ€§éš¾é¢˜
2. **ä¿æŠ¤å…¬æ°‘éšç§æƒ**: è®©ç”¨æˆ·çœŸæ­£æŒæ§è‡ªå·±çš„å¥åº·æ•°æ®
3. **é™ä½Web3ä½¿ç”¨é—¨æ§›**: ä¸ºéæŠ€æœ¯ç”¨æˆ·æä¾›æ— æ„ŸçŸ¥çš„åŒºå—é“¾ä½“éªŒ
4. **æ¨åŠ¨åŒ»ç–—æ•°æ®æ ‡å‡†åŒ–**: ä¸ºè¡Œä¸šæä¾›å¯å‚è€ƒçš„éšç§ä¿æŠ¤æ–¹æ¡ˆ

##### **12.4 è‡´è°¢**

æ„Ÿè°¢æ‰€æœ‰å‚ä¸æœ¬é¡¹ç›®çš„å¼€å‘è€…ã€æµ‹è¯•äººå‘˜å’Œé¡¾é—®ä¸“å®¶ã€‚ç‰¹åˆ«æ„Ÿè°¢ä»¥å¤ªåŠç¤¾åŒºæä¾›çš„ERC4337æ ‡å‡†ï¼Œä»¥åŠé›¶çŸ¥è¯†è¯æ˜é¢†åŸŸçš„å…ˆé©±ç ”ç©¶ã€‚

---

**é¡¹ç›®ä»“åº“**: [GitHub - Elder Medical ZKP Project](https://github.com/your-repo)
**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ31æ—¥
**è”ç³»æ–¹å¼**: [é¡¹ç›®è´Ÿè´£äººé‚®ç®±]

**æœ€æ–°æ›´æ–°**: 
- âœ… å®Œæˆç”¨è¯ç®¡ç†ç³»ç»Ÿï¼ˆMedication Serviceï¼‰
- âœ… é›†æˆå®‰å…¨æ•°æ®ä¼ è¾“ï¼ˆSecure Exchange Serviceï¼‰
- âœ… å®Œæ•´çš„E2Eæµ‹è¯•å¥—ä»¶ï¼ˆåŒ…å«ç”¨è¯ç®¡ç†æµç¨‹æµ‹è¯•ï¼‰

---

## é™„å½•

### é™„å½•A: æœ¯è¯­è¡¨

- **EOA**: Externally Owned Accountï¼Œå¤–éƒ¨è´¦æˆ·ï¼Œç”±ç§é’¥æ§åˆ¶
- **Smart Account**: æ™ºèƒ½åˆçº¦è´¦æˆ·ï¼ŒåŸºäºERC4337çš„æŠ½è±¡è´¦æˆ·
- **UserOperation**: ERC4337ä¸­çš„ç”¨æˆ·æ“ä½œï¼Œç±»ä¼¼äºäº¤æ˜“
- **Paymaster**: Gasä»£ä»˜åˆçº¦ï¼Œä¸ºç”¨æˆ·æ”¯ä»˜äº¤æ˜“è´¹ç”¨
- **å®ˆæŠ¤è€…**: ç¤¾äº¤æ¢å¤æœºåˆ¶ä¸­å¸®åŠ©ç”¨æˆ·æ¢å¤è´¦æˆ·çš„å¯ä¿¡è”ç³»äºº
- **è®¿é—®ç»„**: æƒé™ç®¡ç†çš„åŸºæœ¬å•ä½ï¼Œå†³å®šè°èƒ½è®¿é—®ç‰¹å®šæ•°æ®
- **ZKP**: Zero-Knowledge Proofï¼Œé›¶çŸ¥è¯†è¯æ˜
- **ç«¯åˆ°ç«¯åŠ å¯†**: æ•°æ®åœ¨å‘é€ç«¯åŠ å¯†ï¼Œåªæœ‰æ¥æ”¶ç«¯èƒ½è§£å¯†ï¼Œä¸­é—´æœåŠ¡å™¨æ— æ³•è¯»å–

### é™„å½•B: å¿«é€Ÿå¯åŠ¨å‘½ä»¤

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/elder-medical-zkp.git
cd elder-medical-zkp

# å¯åŠ¨åŸºç¡€è®¾æ–½
docker-compose up -d

# å®‰è£…ä¾èµ–
npm run install:all

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ (Windows)
.\start-all-services.ps1

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ (Linux/Mac)
./start-all-services.sh

# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health
```

### é™„å½•C: ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

```env
# API Gateway
PORT=3000
JWT_SECRET=your_strong_secret_key_here
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:8100

# Database
DB_HOST=localhost
DB_PORT=5400
DB_USER=root
DB_PASSWORD=123456

# Redis
REDIS_URL=redis://localhost:6379

# RabbitMQ
MQ_URL=amqp://localhost:5672

# Blockchain
ETH_NODE_URL=http://localhost:8545
PRIVATE_KEY=your_server_private_key_here
```

### é™„å½•D: å¸¸è§é—®é¢˜FAQ

**Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªåœ°å€ (EOAå’ŒSmart Account)?**
A: EOAç”¨äºç­¾åï¼ŒSmart Accountæ˜¯ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„èº«ä»½æ ‡è¯†ã€‚è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†å®‰å…¨æ€§ï¼ˆç§é’¥ç­¾åï¼‰ï¼Œåˆæä¾›äº†å¯æ‰©å±•æ€§ï¼ˆåˆçº¦è´¦æˆ·ï¼‰ã€‚

**Q2: å¦‚æœæ‰€æœ‰å®ˆæŠ¤è€…éƒ½ä¸å¯ç”¨æ€ä¹ˆåŠ?**
A: è¿™æ˜¯ç¤¾äº¤æ¢å¤çš„å›ºæœ‰é™åˆ¶ã€‚å»ºè®®ç”¨æˆ·è‡³å°‘è®¾ç½®3ä¸ªå®ˆæŠ¤è€…ï¼Œå¹¶è®¾ç½®é˜ˆå€¼ä¸º2ï¼Œé™ä½å•ç‚¹æ•…éšœé£é™©ã€‚

**Q3: Paymasterçš„èµ„é‡‘è€—å°½æ€ä¹ˆåŠ?**
A: ç³»ç»Ÿä¼šç›‘æ§Paymasterä½™é¢ï¼Œä½äºé˜ˆå€¼æ—¶å‘é€å‘Šè­¦ã€‚è¿ç»´äººå‘˜éœ€è¦å®šæœŸå……å€¼ã€‚

**Q4: ZKPè¯æ˜ç”Ÿæˆä¸ºä»€ä¹ˆæœ‰äº›åœ¨å®¢æˆ·ç«¯ï¼Œæœ‰äº›åœ¨æœåŠ¡å™¨ç«¯?**
A: è½»é‡çº§è¯æ˜ï¼ˆå¦‚æ—¥å¸¸æ‰“å¡ï¼‰åœ¨å®¢æˆ·ç«¯ç”Ÿæˆï¼Œç¡®ä¿éšç§å’Œå“åº”é€Ÿåº¦ã€‚é‡é‡çº§è¯æ˜ï¼ˆå¦‚å‘¨åº¦æ±‡æ€»ï¼‰å› è®¡ç®—å¤æ‚åº¦é«˜ï¼Œåœ¨æœåŠ¡å™¨ç«¯å¼‚æ­¥ç”Ÿæˆï¼Œé€šè¿‡æ¨é€é€šçŸ¥è¿”å›ç»“æœã€‚

**Q5: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œ?**
A: ç§é’¥å’Œè§£å¯†åçš„æ•æ„Ÿæ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯æœ¬åœ°ï¼›åŠ å¯†çš„å¥åº·æ•°æ®å­˜å‚¨åœ¨åç«¯æ•°æ®åº“ï¼ˆåç«¯ä¸å¯è§£å¯†ï¼‰ï¼›é›¶çŸ¥è¯†è¯æ˜å’Œé»˜å…‹å°”æ ¹å­˜å‚¨åœ¨åŒºå—é“¾ã€‚ä¸‰å±‚å­˜å‚¨ï¼Œå„å¸å…¶èŒã€‚

---

**æ–‡æ¡£ç»“æŸ**

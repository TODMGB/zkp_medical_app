# 全模块流程测试（手工回归/E2E Checklist）

## 1. 目标与范围
本测试文档用于覆盖前端主要模块的核心流程与关键回归点，适合：
- 日常回归（发布前/合并后）
- 关键缺陷修复后的验证
- 多设备相关功能（账户迁移/生物识别）的全链路确认

**覆盖范围（对应 `src/views`）**
- `onboarding/*`：启动、注册、登录、导入/恢复
- `management/*`：家庭圈/关系/邀请/通知/安全/迁移/设置
- `doctor/*`：医生端用药计划创建与管理
- `elderly/*`：老人端用药计划、打卡、记录与证明
- `core/*`：主页、历史、周统计、证明详情
- `AccountAbstraction.vue`：AA功能自测页
- `Wallet.vue`：钱包自测页（dev）
- `TestCenter.vue / TestMigration.vue / CacheManager.vue`：测试与运维页

**不在范围**
- 纯后端接口的单元测试/压测（可在文末“扩展测试”里补充）

---

## 2. 测试环境与前置条件
### 2.1 基础环境
- **网络**：需要可访问 RPC / API Gateway（按项目配置）
- **设备权限**：相机（扫码）、通知权限、（可选）生物识别权限
- **时间与时区**：建议设备时区为 `UTC+08:00`（用于验证“时间差8小时”等回归点）

### 2.2 测试账号建议（示例）
准备至少 2~3 个账号，覆盖角色与关系：
- **A（老人端）**：用于打卡、接收用药计划、加入家庭圈
- **B（医生端）**：用于创建用药计划并分享
- **C（监护人/家庭成员）**：用于关系、邀请、通知、恢复相关

> 若项目支持一机多账号切换不稳定，建议用多台设备或清理本地数据后再测。

### 2.3 数据清理/回到初始态
在测试前准备一种“回到初始态”的方式（任选其一）：
- 使用 `CacheManager.vue` 清缓存/重置（若提供）
- 卸载重装 App（最彻底）
- 清理 `Preferences` 相关键（仅开发人员操作）

---

## 3. 快速冒烟（Smoke Test）
用于 5~10 分钟确认主链路未断。

### ST-01 启动与路由
- **步骤**
  - 冷启动 App
  - 从启动页进入下一步（注册/登录/导入）
- **预期**
  - 无白屏/报错
  - 路由跳转正常

### ST-02 登录与进入首页
- **步骤**
  - 已注册账号：登录（密码或生物识别）
  - 进入 `/home`
- **预期**
  - 登录成功后进入主页
  - 主页数据区块渲染正常

### ST-03 通知页可加载
- **步骤**
  - 进入 `/notifications`
  - 下拉/刷新
- **预期**
  - 成功获取通知列表或给出可理解的错误提示
  - **回归点**：`encrypted_message` 类型不展示/不计未读（若该功能已实现）

---

## 4. 新手引导/注册/登录（onboarding）
### OB-01 SplashScreen 分流
- **步骤**
  - 清空数据后启动 -> 进入 `SplashScreen`
  - 已注册数据场景启动 -> 观察跳转
- **预期**
  - 未注册：引导到账号选择/注册
  - 已注册：引导到登录（或主页，按设计）

### OB-02 注册流程（SignUp + SetProtectionPin）
- **步骤**
  - `/signup` 输入密码并完成注册
  - 设置保护 PIN（如有）
- **预期**
  - 本地生成并保存钱包加密数据
  - 可进入后续引导页
  - 密码长度/校验提示正确

### OB-03 登录流程（Login）
- **步骤**
  - 使用密码登录
  - 若开启生物识别：触发指纹登录
- **预期**
  - 密码错误：停留本页并提示
  - 密码正确：解锁本地钱包并尝试后端登录（失败不阻断时需提示“离线模式/后端不可用”）

### OB-04 导入账号（ImportAccount）- 扫码导入
- **步骤**
  - 进入 `/import-account`，选择扫码
  - 扫描迁移二维码（由旧设备生成）
  - 输入密码并导入
- **预期**
  - 导入成功后进入 success 页面
  - 点击完成导入进入主页
  - **回归点（重要）**：整个导入过程中不应出现“要求输入解锁密码两次”的体验

### OB-05 导入账号（ImportAccount）- 手动确认码导入
> 若该路径当前为“模拟导入”，仅验证 UI 与输入校验；后续可补齐与 `migrationService` 的真实对接。
- **步骤**
  - 选择手动输入确认码
  - 输入 6 位数字
- **预期**
  - 输入校验/错误提示正确

### OB-06 恢复账号（RecoverAccount / RecoverSetPassword）
- **步骤**
  - 按流程发起恢复
  - 设置新密码
- **预期**
  - 恢复成功后可用新密码登录
  - 异常提示可理解（网络错误/权限不足/输入错误）

### OB-07 Guardian Setup Guide / AddFamily / QRScanner
- **步骤**
  - 跟随引导页面能完整走通
  - `QRScanner` 扫码后能正确处理结果
- **预期**
  - 无崩溃
  - 扫码权限申请正常

---

## 5. 账户抽象 AA（AccountAbstraction + accountAbstraction service）
### AA-01 连通性测试（AccountAbstraction.vue）
- **步骤**
  - 打开 `ERC-4337 账户抽象`页
  - 点击“测试网络”
- **预期**
  - RPC / API 状态展示符合真实情况

### AA-02 注册/登录
- **步骤**
  - 未注册：执行注册
  - 已注册：执行登录
- **预期**
  - 登录后展示 EOA 地址、Smart Account 地址
  - 刷新余额可用（失败有提示）

### AA-03 生物识别开关（enable/disable）
- **步骤**
  - 在安全设置或相关入口启用生物识别
  - 退出后重新进入登录页尝试指纹登录
  - 禁用生物识别
- **预期**
  - 启用后可通过生物识别完成本地解锁
  - 禁用后不再展示指纹入口

---

## 6. 账户迁移（AccountMigration + migrationService）
> 该模块涉及多设备，建议准备：旧设备（有账户数据）+ 新设备（干净安装）。

### MG-01 旧设备生成迁移二维码
- **步骤**
  - 旧设备进入 `/account-migration`
  - 生物识别验证通过
  - 生成二维码并显示确认码
- **预期**
  - 二维码显示正常，倒计时开始
  - 确认码为 6 位

### MG-02 新设备扫码导入（正常链路）
- **步骤**
  - 新设备 `/import-account` 扫码
  - 输入旧设备的确认码（若流程需要）
  - 输入解锁密码并导入
- **预期**
  - 数据下载/解密/导入成功
  - **回归点（重要）**：不应出现“同一流程要求输入解锁密码两次”

### MG-03 新设备导入（密码错误）
- **步骤**
  - 输入错误密码
- **预期**
  - 停留在密码输入界面
  - 展示明确错误文案
  - 不写入脏数据（至少不应导致后续无法重试）

### MG-04 新设备导入（确认码错误/取消）
- **步骤**
  - 输入非 6 位确认码或取消
- **预期**
  - 给出提示并停止流程

### MG-05 网络异常
- **步骤**
  - 迁移过程中断网
- **预期**
  - 下载失败有提示
  - 可重试，不应进入卡死状态

### MG-06 旧设备迁移完成确认与清理
- **步骤**
  - 新设备导入完成后等待旧设备状态变更
  - 或使用旧设备“手动确认完成”
- **预期**
  - 旧设备进入完成态并执行清理策略（按实现）

---

## 7. 家庭圈/群组/邀请（management）
### FC-01 家庭圈列表与创建群组（FamilyCircle.vue）
- **步骤**
  - 进入 `/family-circle`
  - 创建群组
- **预期**
  - 创建成功后列表刷新
  - 异常提示明确

### FC-02 邀请弹窗 UI 回归（CSS）
- **步骤**
  - 在家庭圈内触发“邀请加入群组”弹窗
  - 尝试小屏/窄屏（或浏览器调试）
- **预期**
  - 弹窗居中
  - 内容不溢出屏幕
  - 小屏可滚动
  - 底部按钮区始终可见可点

### FC-03 邀请链接/邀请页（Invitation.vue）
- **步骤**
  - 打开邀请页
  - 使用有效邀请信息进入
- **预期**
  - 能正常加入群组或给出失败原因

### GR-01 群组详情（GroupDetail.vue）
- **步骤**
  - 进入 `/group-detail/:groupId`
  - 查看成员/统计/管理操作
- **预期**
  - 各区块加载正常
  - 需要登录时能自动完成后端登录或提示用户

---

## 8. 关系/患者/监护与恢复（management）
### RL-01 关系中心（RelationshipHub / MyRelationshipsContent）
- **步骤**
  - 打开关系中心
  - 刷新列表
- **预期**
  - 后端登录检查成功
  - 列表渲染正常

### PT-01 我的患者（MyPatients.vue）
- **步骤**
  - 进入 `/my-patients`
  - 加载列表
- **预期**
  - 正常加载/错误提示

### GD-01 监护人设置（GuardianSetup.vue）
- **步骤**
  - 发起恢复/支持恢复/取消恢复（按页面提供操作）
- **预期**
  - 输入校验正确
  - 失败有可理解提示

### RC-01 恢复请求页（RecoveryRequest.vue）
- **步骤**
  - 查看恢复请求
  - 执行批准/拒绝（如有）
- **预期**
  - UI 与状态一致

---

## 9. 用药计划（doctor + medication + elderly）
### DR-01 医生端创建计划（CreateMedicationPlan.vue）
- **步骤**
  - 进入创建计划
  - 填写并提交
- **预期**
  - 创建成功后可在列表/详情看到
  - 输入校验/错误提示清晰

### DR-02 医生端计划列表（MedicationPlans.vue）
- **步骤**
  - 查看计划列表
  - 打开某计划
- **预期**
  - 列表、筛选、进入详情正常

### PL-01 计划详情（PlanDetail.vue）
- **步骤**
  - 打开计划详情
  - 查看用药项、时间表
- **预期**
  - 数据正确展示

### SH-01 计划分享（PlanShare.vue / SharedMedicationPlanDetail.vue）
- **步骤**
  - 生成分享链接/二维码（按实现）
  - 另一账号打开分享详情
- **预期**
  - 分享内容可用

### EL-01 老人端查看我的计划（MyMedicationPlans.vue）
- **步骤**
  - 进入“我的用药计划”
  - 查看计划详情
- **预期**
  - 数据加载正常

---

## 10. 打卡/记录/周统计/证明（elderly + core）
### CK-01 用药打卡（MedicationCheckIn.vue）
- **步骤**
  - 选择计划 -> 执行打卡
- **预期**
  - 打卡记录写入成功
  - UI 状态及时更新

### RD-01 记录详情（RecordDetail.vue）
- **步骤**
  - 从列表进入记录详情
- **预期**
  - 数据完整

### WS-01 周统计（WeeklySummary.vue）
- **步骤**
  - 打开周统计
  - 切换不同周
- **预期**
  - **回归点（重要）**：时间显示不应出现固定 “差8小时” 的问题

### PD-01 证明详情（ProofDetail.vue / CheckinProofDetail.vue）
- **步骤**
  - 打开证明详情
- **预期**
  - 证明内容、时间、状态展示正确

---

## 11. 通知/消息（Notifications + notification services）
### NT-01 通知列表加载与已读
- **步骤**
  - 进入 `/notifications`
  - 刷新列表
  - 点击某条通知
- **预期**
  - 列表加载正常
  - 已读/未读状态变化正确（按实现）

### NT-02 过滤加密消息回归（若已实现过滤）
- **步骤**
  - 触发 `encrypted_message` 类型通知（或模拟数据）
- **预期**
  - 不展示在通知列表
  - 不增加未读计数/角标

### NT-03 本地通知与角标（如启用）
- **步骤**
  - 触发本地通知
- **预期**
  - 通知弹出
  - 角标更新符合规则

---

## 12. 个人资料/设置/安全（Profile / Settings / AccountSecurity）
### PF-01 个人资料（Profile.vue）
- **步骤**
  - 打开资料页
  - 修改并保存（如支持）
- **预期**
  - 保存成功/失败提示清晰

### ST-01 设置（Settings.vue）
- **步骤**
  - 检查各项开关/入口
- **预期**
  - 入口可用，跳转正常

### SC-01 账户安全（AccountSecurity.vue）
- **步骤**
  - 启用/禁用生物识别
  - 检查 PIN/密码相关入口（如有）
- **预期**
  - 开关生效

---

## 13. 测试与运维页（TestCenter / CacheManager / TestMigration / dev pages）
### TS-01 TestCenter
- **步骤**
  - 打开 `TestCenter.vue`
  - 执行页面提供的测试项
- **预期**
  - 无崩溃

### CM-01 CacheManager
- **步骤**
  - 执行清缓存/查看缓存项
- **预期**
  - 清理后状态符合预期

### TM-01 TestMigration
- **步骤**
  - 执行迁移相关测试按钮
- **预期**
  - 能触发迁移服务逻辑（或给出错误提示）

---

## 14. 关键回归点清单（每次必测）
- **R-01 迁移流程不再要求输入解锁密码两次**
  - 新设备导入时只需输入一次密码
- **R-02 邀请/创建群组弹窗 UI 不崩坏**
  - 小屏不溢出，按钮可点
- **R-03 通知/消息过滤（encrypted_message）**
  - 不展示、不计未读、不刷屏
- **R-04 时间显示不出现固定差 8 小时**
  - 周统计/消息/证明等时间字段正确
- **R-05 重复消息/重复通知风暴不再出现**
  - 同一触发不应在短时间内无限重复

---

## 15. 结果记录模板
复制以下模板用于每次回归记录：

- **版本/提交**：
- **测试日期**：
- **测试设备**：
- **网络环境**：
- **通过项**：
- **失败项**：
  - 用例编号：
  - 复现步骤：
  - 实际结果：
  - 预期结果：
  - 日志/截图：
- **备注**：
